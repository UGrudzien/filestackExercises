/*
 * Copyright (c) 2018 by Filestack.
 * Some rights reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define("filestack",["exports"],t):t(e.filestack={})}(this,function(e){"use strict";var t;t={urls:{storeApiUrl:"https://www.filestackapi.com/api/store",fileApiUrl:"https://www.filestackapi.com/api/file",uploadApiUrl:"https://upload.filestackapi.com",cloudApiUrl:"https://cloud.filestackapi.com",cdnUrl:"https://cdn.filestackcontent.com",processApiUrl:"https://process.filestackapi.com",pickerUrl:"https://static.filestackapi.com/picker/1.2.0/picker.js"}};var r=function(){return(r=Object.assign||function(e){for(var t,r=1,n=arguments.length;n>r;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function n(e,t,r,n){return new(r||(r=Promise))(function(i,o){function a(e){try{u(n.next(e))}catch(e){o(e)}}function s(e){try{u(n.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new r(function(t){t(e.value)}).then(a,s)}u((n=n.apply(e,t||[])).next())})}function i(e,t){var r,n,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&i[3]>o[1])){a.label=o[1];break}if(6===o[0]&&i[1]>a.label){a.label=i[1],i=o;break}if(i&&i[2]>a.label){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}var o=function(e){return"function"==typeof e},a=function(e){return null==e},s=function(e){return e.displayName||e.name||"<function"+e.length+">"};function u(e,t){return"function"==typeof t?s(t):t}var c=function(e){try{return JSON.stringify(e,u,2)}catch(t){return e+""}};function p(e,t){!0!==e&&(o(t)?t=t():a(t)&&(t='Assert failed (turn on "Pause on exceptions" in your Source panel)'),p.fail(t))}p.fail=function(e){throw new TypeError("[tcomb] "+e)},p.stringify=c;var l=p,f=function(e){return"string"==typeof e},d=function(e){return Array.isArray?Array.isArray(e):e instanceof Array},h=function(e){return!a(e)&&"object"==typeof e&&!d(e)},m=function(e){return o(e)&&h(e.meta)},y=function(e){return m(e)?e.displayName:s(e)},v=function(e,t){l(!(e instanceof t),function(){return"Cannot use the new operator to instantiate the type "+y(t)})},g=function(e,t){function r(n,i){return v(this,r),i=i||[e],l(t(n),function(){return"Invalid value "+l.stringify(n)+" supplied to "+i.join("/")}),n}return l(f(e),function(){return"Invalid argument name "+l.stringify(e)+" supplied to irreducible(name, predicate) (expected a string)"}),l(o(t),"Invalid argument predicate "+l.stringify(t)+" supplied to irreducible(name, predicate) (expected a function)"),r.meta={kind:"irreducible",name:e,predicate:t,identity:!0},r.displayName=e,r.is=t,r},b=g("Any",function(){return!0}),w=g("Array",d),k=function(e){return!0===e||!1===e},_=g("Boolean",k),x=g("Date",function(e){return e instanceof Date}),E=g("Error",function(e){return e instanceof Error}),A=g("Function",o),T=g("Nil",a),O=function(e){return"number"==typeof e&&isFinite(e)&&!isNaN(e)},P=g("Number",O),S=function(e){return a(e)||f(e)},I=function(e){return!m(e)||(l(_.is(e.meta.identity),function(){return"Invalid meta identity "+l.stringify(e.meta.identity)+" supplied to type "+y(e)}),e.meta.identity)},j=function(e,t,r){return m(e)?e.meta.identity||"object"!=typeof t||null===t?e(t,r):new e(t,r):(r=r||[s(e)],l(t instanceof e,function(){return"Invalid value "+c(t)+" supplied to "+r.join("/")}),t)},C=function(e,t){return m(t)?t.is(e):e instanceof t};function B(e,t){return"{"+y(e)+" | "+s(t)+"}"}function z(e,t,r){l(o(e),function(){return"Invalid argument type "+l.stringify(e)+" supplied to refinement(type, predicate, [name]) combinator (expected a type)"}),l(o(t),function(){return"Invalid argument predicate supplied to refinement(type, predicate, [name]) combinator (expected a function)"}),l(S(r),function(){return"Invalid argument name "+l.stringify(r)+" supplied to refinement(type, predicate, [name]) combinator (expected a string)"});var n=r||B(e,t),i=I(e);function a(r,o){i&&v(this,a);var s=j(e,r,o=o||[n]);return l(t(s),function(){return"Invalid value "+l.stringify(r)+" supplied to "+o.join("/")}),s}return a.meta={kind:"subtype",type:e,predicate:t,name:r,identity:i},a.displayName=n,a.is=function(r){return C(r,e)&&t(r)},a.update=function(e,t){return a(l.update(e,t))},a}z.getDefaultName=B;var N=z,R=N(P,function(e){return e%1==0},"Integer"),U=g("Object",h),q=g("RegExp",function(e){return e instanceof RegExp}),D=g("String",f),M=g("Type",m);function F(e,t){return"{[key: "+y(e)+"]: "+y(t)+"}"}function $(e,t,r){l(o(e),function(){return"Invalid argument domain "+l.stringify(e)+" supplied to dict(domain, codomain, [name]) combinator (expected a type)"}),l(o(t),function(){return"Invalid argument codomain "+l.stringify(t)+" supplied to dict(domain, codomain, [name]) combinator (expected a type)"}),l(S(r),function(){return"Invalid argument name "+l.stringify(r)+" supplied to dict(domain, codomain, [name]) combinator (expected a string)"});var n=r||F(e,t),i=y(e),a=y(t),s=I(e)&&I(t);function u(r,o){o=o||[n],l(h(r),function(){return"Invalid value "+l.stringify(r)+" supplied to "+o.join("/")});var s=!0,u={};for(var c in r)if(r.hasOwnProperty(c)){c=j(e,c,o.concat(i));var p=r[c],f=j(t,p,o.concat(c+": "+a));s=s&&p===f,u[c]=f}return s&&(u=r),Object.freeze(u),u}return u.meta={kind:"dict",domain:e,codomain:t,name:r,identity:s},u.displayName=n,u.is=function(r){if(!h(r))return!1;for(var n in r)if(r.hasOwnProperty(n)&&(!C(n,e)||!C(r[n],t)))return!1;return!0},u.update=function(e,t){return u(l.update(e,t))},u}$.getDefaultName=F;var L=$,H=function(e,t,r){if(a(t))return e;for(var n in t)t.hasOwnProperty(n)&&(!0!==r&&l(!e.hasOwnProperty(n)||e[n]===t[n],function(){return'Invalid call to mixin(target, source, [overwrite]): cannot overwrite property "'+n+'" of target object'}),e[n]=t[n]);return e},V=function(e){return m(e)&&"union"===e.meta.kind},X=1;function W(e){return Object.keys(e).map(function(e){return l.stringify(e)}).join(" | ")}function G(e,t){l(h(e),function(){return"Invalid argument map "+l.stringify(e)+" supplied to enums(map, [name]) combinator (expected a dictionary of String -> String | Number)"}),l(S(t),function(){return"Invalid argument name "+l.stringify(t)+" supplied to enums(map, [name]) combinator (expected a string)"});var r=t||W(e);function n(t,i){return v(this,n),i=i||[r],l(n.is(t),function(){return"Invalid value "+l.stringify(t)+" supplied to "+i.join("/")+" (expected one of "+l.stringify(Object.keys(e))+")"}),t}return n.meta={kind:"enums",map:e,name:t,identity:!0},n.displayName=r,n.is=function(t){return e.hasOwnProperty(t)},n}G.of=function(e,t){e=f(e)?e.split(" "):e;var r={};return e.forEach(function(e){r[e]=e}),G(r,t)},G.getDefaultName=W;var J=G;function K(e){return"Array<"+y(e)+">"}function Z(e,t){l(o(e),function(){return"Invalid argument type "+l.stringify(e)+" supplied to list(type, [name]) combinator (expected a type)"}),l(S(t),function(){return"Invalid argument name "+l.stringify(t)+" supplied to list(type, [name]) combinator (expected a string)"});var r=t||K(e),n=y(e),i=I(e);function a(t,i){i=i||[r],l(d(t),function(){return"Invalid value "+l.stringify(t)+" supplied to "+i.join("/")+" (expected an array of "+n+")"});for(var o=!0,a=[],s=0,u=t.length;u>s;s++){var c=t[s],p=j(e,c,i.concat(s+": "+n));o=o&&c===p,a.push(p)}return o&&(a=t),Object.freeze(a),a}return a.meta={kind:"list",type:e,name:t,identity:i},a.displayName=r,a.is=function(t){return d(t)&&t.every(function(t){return C(t,e)})},a.update=function(e,t){return a(l.update(e,t))},a}Z.getDefaultName=K;var Q=Z,Y=function(e){return m(e)&&"maybe"===e.meta.kind};function ee(e){return"?"+y(e)}function te(e,t){if(Y(e)||e===b||e===T)return e;l(o(e),function(){return"Invalid argument type "+l.stringify(e)+" supplied to maybe(type, [name]) combinator (expected a type)"}),l(S(t),function(){return"Invalid argument name "+l.stringify(t)+" supplied to maybe(type, [name]) combinator (expected a string)"});var r=t||ee(e),n=I(e);function i(t,r){return n&&v(this,i),T.is(t)?t:j(e,t,r)}return i.meta={kind:"maybe",type:e,name:t,identity:n},i.displayName=r,i.is=function(t){return T.is(t)||C(t,e)},i}te.getDefaultName=ee;var re=te;var ne=function(e){return"{"+Object.keys(e).map(function(t){return t+": "+y(e[t])}).join(", ")+"}"},ie=function(e){return m(e)&&"struct"===e.meta.kind},oe=function(e){return m(e)&&"interface"===e.meta.kind};function ae(e){return m(e)&&"subtype"===e.meta.kind}var se=function(e){return{predicates:function e(t){return ae(t)?[t.meta.predicate].concat(e(t.meta.type)):[]}(e),unrefinedType:function e(t){return ae(t)?e(t.meta.type):t}(e)}};var ue=function(e,t,r){l(o(e),function(){return"Invalid argument combinator supplied to extend(combinator, mixins, options), expected a function"}),l(d(t),function(){return"Invalid argument mixins supplied to extend(combinator, mixins, options), expected an array"});var n={},i={},a=[],s={};t.forEach(function(e,t){var r,o=se(e),u=o.unrefinedType;l(h(u)||ie(u)||oe(u),function(){return"Invalid argument mixins["+t+"] supplied to extend(combinator, mixins, options), expected an object, struct, interface or a refinement (of struct or interface)"}),Array.prototype.push.apply(a,o.predicates),H(n,h(r=u)?r:r.meta.props),H(i,u.prototype),H(s,function(e){return h(e)?null:e.meta.defaultProps}(u),!0)}),(r=e.getOptions(r)).defaultProps=H(s,r.defaultProps,!0);var u=function(e,t,r){var n=e.reduce(function(e,t){return N(e,t)},t);return r&&(n.displayName=r,n.meta.name=r),n}(a,e(n,{strict:r.strict,defaultProps:r.defaultProps}),r.name);return H(u.prototype,i),u};function ce(e){return"Struct"+ne(e)}function pe(e,t){return ue(fe,e,t)}function le(e){return h(e)||(e=a(e)?{}:{name:e}),e.hasOwnProperty("strict")||(e.strict=fe.strict),e.hasOwnProperty("defaultProps")||(e.defaultProps={}),e}function fe(e,t){var r=(t=le(t)).name,n=t.strict,i=t.defaultProps;l(L(D,A).is(e),function(){return"Invalid argument props "+l.stringify(e)+" supplied to struct(props, [options]) combinator (expected a dictionary String -> Type)"}),l(S(r),function(){return"Invalid argument name "+l.stringify(r)+" supplied to struct(props, [options]) combinator (expected a string)"}),l(k(n),function(){return"Invalid argument strict "+l.stringify(n)+" supplied to struct(props, [options]) combinator (expected a boolean)"}),l(h(i),function(){return"Invalid argument defaultProps "+l.stringify(i)+" supplied to struct(props, [options]) combinator (expected an object)"});var o=r||ce(e);function a(t,r){if(a.is(t))return t;if(r=r||[o],l(h(t),function(){return"Invalid value "+l.stringify(t)+" supplied to "+r.join("/")+" (expected an object)"}),n)for(s in t)t.hasOwnProperty(s)&&l(e.hasOwnProperty(s),function(){return'Invalid additional prop "'+s+'" supplied to '+r.join("/")});if(!(this instanceof a))return new a(t,r);for(var s in e)if(e.hasOwnProperty(s)){var u=e[s],c=t[s];void 0===c&&(c=i[s]),this[s]=j(u,c,r.concat(s+": "+y(u)))}Object.freeze(this)}return a.meta={kind:"struct",props:e,name:r,identity:!1,strict:n,defaultProps:i},a.displayName=o,a.is=function(e){return e instanceof a},a.update=function(e,t){return new a(l.update(e,t))},a.extend=function(e,t){return pe([a].concat(e),t)},a}fe.strict=!1,fe.getOptions=le,fe.getDefaultName=ce,fe.extend=pe;var de=fe;function he(e){return"["+e.map(y).join(", ")+"]"}function me(e,t){l(d(e)&&e.every(o),function(){return"Invalid argument types "+l.stringify(e)+" supplied to tuple(types, [name]) combinator (expected an array of types)"}),l(S(t),function(){return"Invalid argument name "+l.stringify(t)+" supplied to tuple(types, [name]) combinator (expected a string)"});var r=t||he(e),n=e.every(I);function i(t,n){n=n||[r],l(d(t)&&t.length===e.length,function(){return"Invalid value "+l.stringify(t)+" supplied to "+n.join("/")+" (expected an array of length "+e.length+")"});for(var i=!0,o=[],a=0,s=e.length;s>a;a++){var u=e[a],c=t[a],p=j(u,c,n.concat(a+": "+y(u)));i=i&&c===p,o.push(p)}return i&&(o=t),Object.freeze(o),o}return i.meta={kind:"tuple",types:e,name:t,identity:n},i.displayName=r,i.is=function(t){return d(t)&&t.length===e.length&&e.every(function(e,r){return C(t[r],e)})},i.update=function(e,t){return i(l.update(e,t))},i}me.getDefaultName=he;var ye=me;function ve(e){return e.map(y).join(" | ")}function ge(e,t){l(d(e)&&e.every(o)&&e.length>=2,function(){return"Invalid argument types "+l.stringify(e)+" supplied to union(types, [name]) combinator (expected an array of at least 2 types)"}),l(S(t),function(){return"Invalid argument name "+l.stringify(t)+" supplied to union(types, [name]) combinator (expected a string)"});var r=t||ve(e),n=e.every(I);function i(e,t){var a=i.dispatch(e);return!a&&i.is(e)?e:(n&&v(this,i),t=t||[r],l(o(a),function(){return"Invalid value "+l.stringify(e)+" supplied to "+t.join("/")+" (no constructor returned by dispatch)"}),t[t.length-1]+="("+y(a)+")",j(a,e,t))}return i.meta={kind:"union",types:e,name:t,identity:n},i.displayName=r,i.is=function(t){return e.some(function(e){return C(t,e)})},i.dispatch=function(t){for(var r=0,n=e.length;n>r;r++){var i=e[r];if(V(i)){var o=i.dispatch(t);if(!a(o))return o}else if(C(t,i))return i}},i.update=function(e,t){return i(l.update(e,t))},i}ge.getDefaultName=ve;var be=ge;function we(e,t){return"("+e.map(y).join(", ")+") => "+y(t)}function ke(e){return A.is(e)&&h(e.instrumentation)}function _e(e){for(var t=e.length,r=!1,n=t-1;n>=0;n--){var i=e[n];if(!m(i)||"maybe"!==i.meta.kind)return n+1;r=!0}return r?0:t}function xe(e,t,r){e=d(e)?e:[e],l(Q(A).is(e),function(){return"Invalid argument domain "+l.stringify(e)+" supplied to func(domain, codomain, [name]) combinator (expected an array of types)"}),l(A.is(t),function(){return"Invalid argument codomain "+l.stringify(t)+" supplied to func(domain, codomain, [name]) combinator (expected a type)"}),l(S(r),function(){return"Invalid argument name "+l.stringify(r)+" supplied to func(domain, codomain, [name]) combinator (expected a string)"});var n=r||we(e,t),i=e.length,o=_e(e);function u(e,t){return ke(e)?(t=t||[n],l(u.is(e),function(){return"Invalid value "+l.stringify(e)+" supplied to "+t.join("/")}),e):u.of(e)}return u.meta={kind:"func",domain:e,codomain:t,name:r,identity:!0},u.displayName=n,u.is=function(r){return ke(r)&&r.instrumentation.domain.length===i&&r.instrumentation.domain.every(function(t,r){return t===e[r]})&&r.instrumentation.codomain===t},u.of=function(r,c){if(l(A.is(r),function(){return"Invalid argument f supplied to func.of "+n+" (expected a function)"}),l(a(c)||k(c),function(){return"Invalid argument curried "+l.stringify(c)+" supplied to func.of "+n+" (expected a boolean)"}),u.is(r))return r;function p(){var a=Array.prototype.slice.call(arguments),s=a.length;if(ye(e.slice(0,c?s:Math.max(s,o)),"arguments of function "+n)(a),c&&i>s){l(s>0,"Invalid arguments.length = 0 for curried function "+n);var u=Function.prototype.bind.apply(r,[this].concat(a));return xe(e.slice(s),t).of(u,!0)}return j(t,r.apply(this,a))}return p.instrumentation={domain:e,codomain:t,f:r},p.displayName=s(r),p},u}xe.getDefaultName=we,xe.getOptionalArgumentsIndex=_e;var Ee=xe,Ae=I;function Te(e){return e.map(y).join(" & ")}function Oe(e,t){l(d(e)&&e.every(o)&&e.length>=2,function(){return"Invalid argument types "+l.stringify(e)+" supplied to intersection(types, [name]) combinator (expected an array of at least 2 types)"}),l(S(t),function(){return"Invalid argument name "+l.stringify(t)+" supplied to intersection(types, [name]) combinator (expected a string)"});var r=t||Te(e),n=e.every(Ae);function i(e,t){return n&&I(this,i),t=t||[r],l(i.is(e),function(){return"Invalid value "+l.stringify(e)+" supplied to "+t.join("/")}),e}return i.meta={kind:"intersection",types:e,name:t,identity:n},i.displayName=r,i.is=function(t){return e.every(function(e){return C(t,e)})},i.update=function(e,t){return i(l.update(e,t))},i}Oe.getDefaultName=Te;var Pe=Oe;var Se=function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);return e};function Ie(e,t){return ue(Ce,e,t)}function je(e){return h(e)||(e=a(e)?{}:{name:e}),e.hasOwnProperty("strict")||(e.strict=Ce.strict),e}function Ce(e,t){var r=(t=je(t)).name,n=t.strict;l(L(D,A).is(e),function(){return"Invalid argument props "+l.stringify(e)+" supplied to interface(props, [options]) combinator (expected a dictionary String -> Type)"}),l(S(r),function(){return"Invalid argument name "+l.stringify(r)+" supplied to interface(props, [options]) combinator (expected a string)"}),l(k(n),function(){return"Invalid argument strict "+l.stringify(n)+" supplied to struct(props, [options]) combinator (expected a boolean)"});var i=r||ne(e),o=Object.keys(e).map(function(t){return e[t]}).every(I);function s(t,r){if(r=r||[i],l(!a(t),function(){return"Invalid value "+t+" supplied to "+r.join("/")}),n)for(var s in t)l(e.hasOwnProperty(s),function(){return'Invalid additional prop "'+s+'" supplied to '+r.join("/")});var u=!0,c=o?{}:Se({},t);for(var p in e){var f=e[p],d=t[p],h=j(f,d,r.concat(p+": "+y(f)));u=u&&d===h,c[p]=h}return u&&(c=t),Object.freeze(c),c}return s.meta={kind:"interface",props:e,name:r,identity:o,strict:n},s.displayName=i,s.is=function(t){if(a(t))return!1;if(n)for(var r in t)if(!e.hasOwnProperty(r))return!1;for(var i in e)if(!C(t[i],e[i]))return!1;return!0},s.update=function(e,t){return s(l.update(e,t))},s.extend=function(e,t){return Ie([s].concat(e),t)},s}Ce.strict=!1,Ce.getOptions=je,Ce.getDefaultName=ne,Ce.extend=Ie;var Be=Ce;function ze(e){return h(e)?e instanceof Date||e instanceof RegExp?e:Se({},e):d(e)?e.concat():e}function Ne(e){return Ue.commands.hasOwnProperty(e)}function Re(e){return Ue.commands[e]}function Ue(e,t){l(h(t),function(){return"Invalid argument patch "+l.stringify(t)+" supplied to function update(instance, patch): expected an object containing commands"});var r,n=e,i=!1;for(var o in t)t.hasOwnProperty(o)&&(Ne(o)?(r=Re(o)(t[o],n))!==e?(i=!0,n=r):n=e:(n===e&&(n=ze(e)),r=Ue(n[o],t[o]),i=i||r!==n[o],n[o]=r));return i?n:e}Ue.commands={$apply:function(e,t){return l(o(e),"Invalid argument f supplied to immutability helper { $apply: f } (expected a function)"),e(t)},$push:function(e,t){return l(d(e),"Invalid argument elements supplied to immutability helper { $push: elements } (expected an array)"),l(d(t),"Invalid value supplied to immutability helper $push (expected an array)"),e.length>0?t.concat(e):t},$remove:function(e,t){if(l(d(e),"Invalid argument keys supplied to immutability helper { $remove: keys } (expected an array)"),l(h(t),"Invalid value supplied to immutability helper $remove (expected an object)"),e.length>0){t=ze(t);for(var r=0,n=e.length;n>r;r++)delete t[e[r]]}return t},$set:function(e){return e},$splice:function(e,t){return l(d(e)&&e.every(d),"Invalid argument splices supplied to immutability helper { $splice: splices } (expected an array of arrays)"),l(d(t),"Invalid value supplied to immutability helper $splice (expected an array)"),e.length>0?(t=ze(t),e.reduce(function(e,t){return e.splice.apply(e,t),e},t)):t},$swap:function(e,t){if(l(h(e),"Invalid argument config supplied to immutability helper { $swap: config } (expected an object)"),l(O(e.from),"Invalid argument config.from supplied to immutability helper { $swap: config } (expected a number)"),l(O(e.to),"Invalid argument config.to supplied to immutability helper { $swap: config } (expected a number)"),l(d(t),"Invalid value supplied to immutability helper $swap (expected an array)"),e.from!==e.to){var r=(t=ze(t))[e.to];t[e.to]=t[e.from],t[e.from]=r}return t},$unshift:function(e,t){return l(d(e),"Invalid argument elements supplied to immutability helper {$unshift: elements} (expected an array)"),l(d(t),"Invalid value supplied to immutability helper $unshift (expected an array)"),e.length>0?e.concat(t):t},$merge:function(e,t){var r=!1,n=ze(t);for(var i in e)e.hasOwnProperty(i)&&(n[i]=e[i],r=r||n[i]!==t[i]);return r?n:t}};var qe=Ue;l.Any=b,l.Array=w,l.Boolean=_,l.Date=x,l.Error=E,l.Function=A,l.Nil=T,l.Number=P,l.Integer=R,l.IntegerT=l.Integer,l.Object=U,l.RegExp=q,l.String=D,l.Type=M,l.TypeT=l.Type,l.Arr=l.Array,l.Bool=l.Boolean,l.Dat=l.Date,l.Err=l.Error,l.Func=l.Function,l.Num=l.Number,l.Obj=l.Object,l.Re=l.RegExp,l.Str=l.String,l.dict=L,l.declare=function(e){var t;function r(n,i){return l(!a(t),function(){return"Type declared but not defined, don't forget to call .define on every declared type"}),V(t)&&l(t.dispatch===r.dispatch,function(){return"Please define the custom "+e+".dispatch function before calling "+e+".define()"}),t(n,i)}return l(S(e),function(){return"Invalid argument name "+e+" supplied to declare([name]) (expected a string)"}),r.define=function(n){return l(m(n),function(){return"Invalid argument type "+l.stringify(n)+" supplied to define(type) (expected a type)"}),l(a(t),function(){return"Declare.define(type) can only be invoked once"}),V(n)&&r.hasOwnProperty("dispatch")&&(n.dispatch=r.dispatch),H(r,t=n,!0),e&&(t.displayName=r.displayName=e,r.meta.name=e),r.meta.identity=t.meta.identity,r.prototype=t.prototype,r},r.displayName=e||y(r)+"$"+X++,r.meta={identity:!1},r.prototype=null,r},l.enums=J,l.irreducible=g,l.list=Q,l.maybe=re,l.refinement=N,l.struct=de,l.tuple=ye,l.union=be,l.func=Ee,l.intersection=Pe,l.subtype=l.refinement,l.inter=Be,l.interface=l.inter,l.assert=l,l.update=qe,l.mixin=H,l.isType=m,l.is=C,l.getTypeName=y,l.match=function(e){for(var t,r,n,i,a=1,s=arguments.length;s>a;)if(t=arguments[a],r=arguments[a+1],o(n=arguments[a+2])&&!m(n)?a+=3:(n=r,r=b.is,a+=2),i=(i||0)+1,l(m(t),function(){return"Invalid type in clause #"+i}),l(o(r),function(){return"Invalid guard in clause #"+i}),l(o(n),function(){return"Invalid block in clause #"+i}),t.is(e)&&r(e))return n(e);l.fail("Match error")};var De=l,Me=De.stringify,Fe={},$e=De.struct({message:De.Any,actual:De.Any,expected:De.Any,path:De.list(De.union([De.String,De.Number]))},"ValidationError");function Le(e,t,r,n){return De.Function.is(t.getValidationErrorMessage)?t.getValidationErrorMessage(e,r,n):function(e,t,r){var n=De.getTypeName(t),i=r.length?"/"+r.join("/")+": "+n:n;return"Invalid value "+Me(e)+" supplied to "+i}(e,t,r)}$e.of=function(e,t,r,n){return new $e({message:Le(e,t,r,n),actual:e,expected:t,path:r})};var He=De.struct({errors:De.list($e),value:De.Any},"ValidationResult");function Ve(e,t,r){var n=De.Array.is(r=r||{})?r:r.path||[];return new He(Xe(e,t,n,r))}function Xe(e,t,r,n){return De.isType(t)?We[t.meta.kind](e,t,r,n):We.es6classes(e,t,r,n)}He.prototype.isValid=function(){return!this.errors.length},He.prototype.firstError=function(){return this.isValid()?null:this.errors[0]},He.prototype.toString=function(){return this.isValid()?"[ValidationResult, true, "+Me(this.value)+"]":"[ValidationResult, false, ("+this.errors.map(function(e){return Me(e.message)}).join(", ")+")]"};var We=Ve.validators={};We.es6classes=function(e,t,r,n){return{value:e,errors:e instanceof t?[]:[$e.of(e,t,r,n.context)]}},We.irreducible=We.enums=function(e,t,r,n){return{value:e,errors:t.is(e)?[]:[$e.of(e,t,r,n.context)]}},We.list=function(e,t,r,n){if(!De.Array.is(e))return{value:e,errors:[$e.of(e,t,r,n.context)]};for(var i={value:[],errors:[]},o=0,a=e.length;a>o;o++){var s=Xe(e[o],t.meta.type,r.concat(o),n);i.value[o]=s.value,i.errors=i.errors.concat(s.errors)}return i},We.subtype=function(e,t,r,n){var i=Xe(e,t.meta.type,r,n);return i.errors.length?i:(t.meta.predicate(i.value)||(i.errors=[$e.of(e,t,r,n.context)]),i)},We.maybe=function(e,t,r,n){return De.Nil.is(e)?{value:e,errors:[]}:Xe(e,t.meta.type,r,n)},We.struct=function(e,t,r,n){if(!De.Object.is(e))return{value:e,errors:[$e.of(e,t,r,n.context)]};if(t.is(e))return{value:e,errors:[]};var i={value:{},errors:[]},o=t.meta.props,a=t.meta.defaultProps||Fe;for(var s in o)if(o.hasOwnProperty(s)){var u=e[s];void 0===u&&(u=a[s]);var c=Xe(u,o[s],r.concat(s),n);i.value[s]=c.value,i.errors=i.errors.concat(c.errors)}if(n.hasOwnProperty("strict")?n.strict:t.meta.strict)for(var p in e)e.hasOwnProperty(p)&&!o.hasOwnProperty(p)&&i.errors.push($e.of(e[p],De.Nil,r.concat(p),n.context));return i.errors.length||(i.value=new t(i.value)),i},We.tuple=function(e,t,r,n){var i=t.meta.types,o=i.length;if(!De.Array.is(e)||e.length>o)return{value:e,errors:[$e.of(e,t,r,n.context)]};for(var a={value:[],errors:[]},s=0;o>s;s++){var u=Xe(e[s],i[s],r.concat(s),n);a.value[s]=u.value,a.errors=a.errors.concat(u.errors)}return a},We.dict=function(e,t,r,n){if(!De.Object.is(e))return{value:e,errors:[$e.of(e,t,r,n.context)]};var i={value:{},errors:[]};for(var o in e)if(e.hasOwnProperty(o)){var a=r.concat(o),s=Xe(o,t.meta.domain,a,n),u=Xe(e[o],t.meta.codomain,a,n);i.value[o]=u.value,i.errors=i.errors.concat(s.errors,u.errors)}return i},We.union=function(e,t,r,n){var i=t.dispatch(e);return De.Function.is(i)?Xe(e,i,r.concat(t.meta.types.indexOf(i)),n):{value:e,errors:[$e.of(e,t,r,n.context)]}},We.intersection=function(e,t,r,n){for(var i=t.meta.types,o=i.length,a={value:e,errors:[]},s=0,u=0;o>u;u++){"struct"===i[u].meta.kind&&s++;var c=Xe(e,i[u],r,n);a.errors=a.errors.concat(c.errors)}return s>1&&a.errors.push($e.of(e,t,r,n.context)),a},We.interface=function(e,t,r,n){if(!De.Object.is(e))return{value:e,errors:[$e.of(e,t,r,n.context)]};var i={value:{},errors:[]},o=t.meta.props;for(var a in o){var s=Xe(e[a],o[a],r.concat(a),n);i.value[a]=s.value,i.errors=i.errors.concat(s.errors)}if(n.hasOwnProperty("strict")?n.strict:t.meta.strict)for(var u in e)o.hasOwnProperty(u)||De.Nil.is(e[u])||i.errors.push($e.of(e[u],De.Nil,r.concat(u),n.context));return i},De.mixin(De,{ValidationError:$e,ValidationResult:He,validate:Ve});var Ge=De.Boolean,Je=De.Function,Ke=De.Integer,Ze=De.Number,Qe=De.String,Ye=De.enums,et=De.refinement,tt=De.union,rt=De.tuple,nt=De.struct,it=De.validate,ot=De.maybe,at=De.list,st="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function ut(e,t){return e(t={exports:{}},t.exports),t.exports}var ct=ut(function(e){function t(e){if(e)return function(e){for(var r in t.prototype)e[r]=t.prototype[r];return e}(e)}e.exports=t,t.prototype.on=t.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this},t.prototype.once=function(e,t){function r(){this.off(e,r),t.apply(this,arguments)}return r.fn=t,this.on(e,r),this},t.prototype.off=t.prototype.removeListener=t.prototype.removeAllListeners=t.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var r,n=this._callbacks["$"+e];if(!n)return this;if(1==arguments.length)return delete this._callbacks["$"+e],this;for(var i=0;n.length>i;i++)if((r=n[i])===t||r.fn===t){n.splice(i,1);break}return this},t.prototype.emit=function(e){this._callbacks=this._callbacks||{};var t=[].slice.call(arguments,1),r=this._callbacks["$"+e];if(r)for(var n=0,i=(r=r.slice(0)).length;i>n;++n)r[n].apply(this,t);return this},t.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]},t.prototype.hasListeners=function(e){return!!this.listeners(e).length}});var pt=function(e){return null!==e&&"object"==typeof e},lt=ft;function ft(e){if(e)return function(e){for(var t in ft.prototype)e[t]=ft.prototype[t];return e}(e)}ft.prototype.clearTimeout=function(){return clearTimeout(this._timer),clearTimeout(this._responseTimeoutTimer),delete this._timer,delete this._responseTimeoutTimer,this},ft.prototype.parse=function(e){return this._parser=e,this},ft.prototype.responseType=function(e){return this._responseType=e,this},ft.prototype.serialize=function(e){return this._serializer=e,this},ft.prototype.timeout=function(e){if(!e||"object"!=typeof e)return this._timeout=e,this._responseTimeout=0,this;for(var t in e)switch(t){case"deadline":this._timeout=e.deadline;break;case"response":this._responseTimeout=e.response;break;default:console.warn("Unknown timeout option",t)}return this},ft.prototype.retry=function(e,t){return 0!==arguments.length&&!0!==e||(e=1),e>0||(e=0),this._maxRetries=e,this._retries=0,this._retryCallback=t,this};var dt=["ECONNRESET","ETIMEDOUT","EADDRINFO","ESOCKETTIMEDOUT"];ft.prototype._shouldRetry=function(e,t){if(!this._maxRetries||this._retries++>=this._maxRetries)return!1;if(this._retryCallback)try{var r=this._retryCallback(e,t);if(!0===r)return!0;if(!1===r)return!1}catch(e){console.error(e)}if(t&&t.status&&t.status>=500&&501!=t.status)return!0;if(e){if(e.code&&~dt.indexOf(e.code))return!0;if(e.timeout&&"ECONNABORTED"==e.code)return!0;if(e.crossDomain)return!0}return!1},ft.prototype._retry=function(){return this.clearTimeout(),this.req&&(this.req=null,this.req=this.request()),this._aborted=!1,this.timedout=!1,this._end()},ft.prototype.then=function(e,t){if(!this._fullfilledPromise){var r=this;this._endCalled&&console.warn("Warning: superagent request was sent twice, because both .end() and .then() were called. Never call .end() if you use promises"),this._fullfilledPromise=new Promise(function(e,t){r.end(function(r,n){r?t(r):e(n)})})}return this._fullfilledPromise.then(e,t)},ft.prototype.catch=function(e){return this.then(void 0,e)},ft.prototype.use=function(e){return e(this),this},ft.prototype.ok=function(e){if("function"!=typeof e)throw Error("Callback required");return this._okCallback=e,this},ft.prototype._isResponseOK=function(e){return!!e&&(this._okCallback?this._okCallback(e):e.status>=200&&300>e.status)},ft.prototype.getHeader=ft.prototype.get=function(e){return this._header[e.toLowerCase()]},ft.prototype.set=function(e,t){if(pt(e)){for(var r in e)this.set(r,e[r]);return this}return this._header[e.toLowerCase()]=t,this.header[e]=t,this},ft.prototype.unset=function(e){return delete this._header[e.toLowerCase()],delete this.header[e],this},ft.prototype.field=function(e,t){if(null==e)throw Error(".field(name, val) name can not be empty");if(this._data&&console.error(".field() can't be used if .send() is used. Please use only .send() or only .field() & .attach()"),pt(e)){for(var r in e)this.field(r,e[r]);return this}if(Array.isArray(t)){for(var n in t)this.field(e,t[n]);return this}if(null==t)throw Error(".field(name, val) val can not be empty");return"boolean"==typeof t&&(t=""+t),this._getFormData().append(e,t),this},ft.prototype.abort=function(){return this._aborted?this:(this._aborted=!0,this.xhr&&this.xhr.abort(),this.req&&this.req.abort(),this.clearTimeout(),this.emit("abort"),this)},ft.prototype._auth=function(e,t,r,n){switch(r.type){case"basic":this.set("Authorization","Basic "+n(e+":"+t));break;case"auto":this.username=e,this.password=t;break;case"bearer":this.set("Authorization","Bearer "+e)}return this},ft.prototype.withCredentials=function(e){return null==e&&(e=!0),this._withCredentials=e,this},ft.prototype.redirects=function(e){return this._maxRedirects=e,this},ft.prototype.maxResponseSize=function(e){if("number"!=typeof e)throw TypeError("Invalid argument");return this._maxResponseSize=e,this},ft.prototype.toJSON=function(){return{method:this.method,url:this.url,data:this._data,headers:this._header}},ft.prototype.send=function(e){var t=pt(e),r=this._header["content-type"];if(this._formData&&console.error(".send() can't be used if .attach() or .field() is used. Please use only .send() or only .field() & .attach()"),t&&!this._data)Array.isArray(e)?this._data=[]:this._isHost(e)||(this._data={});else if(e&&this._data&&this._isHost(this._data))throw Error("Can't merge these send calls");if(t&&pt(this._data))for(var n in e)this._data[n]=e[n];else"string"==typeof e?(r||this.type("form"),this._data="application/x-www-form-urlencoded"==(r=this._header["content-type"])?this._data?this._data+"&"+e:e:(this._data||"")+e):this._data=e;return!t||this._isHost(e)?this:(r||this.type("json"),this)},ft.prototype.sortQuery=function(e){return this._sort=void 0===e||e,this},ft.prototype._finalizeQueryString=function(){var e=this._query.join("&");if(e&&(this.url+=(0>this.url.indexOf("?")?"?":"&")+e),this._query.length=0,this._sort){var t=this.url.indexOf("?");if(t>=0){var r=this.url.substring(t+1).split("&");"function"==typeof this._sort?r.sort(this._sort):r.sort(),this.url=this.url.substring(0,t)+"?"+r.join("&")}}},ft.prototype._appendQueryString=function(){console.trace("Unsupported")},ft.prototype._timeoutError=function(e,t,r){if(!this._aborted){var n=Error(e+t+"ms exceeded");n.timeout=t,n.code="ECONNABORTED",n.errno=r,this.timedout=!0,this.abort(),this.callback(n)}},ft.prototype._setTimeouts=function(){var e=this;this._timeout&&!this._timer&&(this._timer=setTimeout(function(){e._timeoutError("Timeout of ",e._timeout,"ETIME")},this._timeout)),this._responseTimeout&&!this._responseTimeoutTimer&&(this._responseTimeoutTimer=setTimeout(function(){e._timeoutError("Response timeout of ",e._responseTimeout,"ETIMEDOUT")},this._responseTimeout))};var ht=function(e){return e.split(/ *; */).shift()},mt=function(e){return e.split(/ *; */).reduce(function(e,t){var r=t.split(/ *= */),n=r.shift(),i=r.shift();return n&&i&&(e[n]=i),e},{})},yt=function(e){return e.split(/ *, */).reduce(function(e,t){var r=t.split(/ *; */),n=r[0].slice(1,-1);return e[r[1].split(/ *= */)[1].slice(1,-1)]=n,e},{})},vt=gt;function gt(e){if(e)return function(e){for(var t in gt.prototype)e[t]=gt.prototype[t];return e}(e)}function bt(){this._defaults=[]}gt.prototype.get=function(e){return this.header[e.toLowerCase()]},gt.prototype._setHeaderProperties=function(e){var t=e["content-type"]||"";this.type=ht(t);var r=mt(t);for(var n in r)this[n]=r[n];this.links={};try{e.link&&(this.links=yt(e.link))}catch(e){}},gt.prototype._setStatusProperties=function(e){var t=e/100|0;this.status=this.statusCode=e,this.statusType=t,this.info=1==t,this.ok=2==t,this.redirect=3==t,this.clientError=4==t,this.serverError=5==t,this.error=(4==t||5==t)&&this.toError(),this.created=201==e,this.accepted=202==e,this.noContent=204==e,this.badRequest=400==e,this.unauthorized=401==e,this.notAcceptable=406==e,this.forbidden=403==e,this.notFound=404==e,this.unprocessableEntity=422==e},["use","on","once","set","query","type","accept","auth","withCredentials","sortQuery","retry","ok","redirects","timeout","buffer","serialize","parse","ca","key","pfx","cert"].forEach(function(e){bt.prototype[e]=function(){return this._defaults.push({fn:e,arguments:arguments}),this}}),bt.prototype._setDefaults=function(e){this._defaults.forEach(function(t){e[t.fn].apply(e,t.arguments)})};var wt=bt,kt=ut(function(e,t){var r;function n(){}"undefined"!=typeof window?r=window:"undefined"!=typeof self?r=self:(console.warn("Using browser-only version of superagent in non-browser environment"),r=st);var i=t=e.exports=function(e,r){return"function"==typeof r?new t.Request("GET",e).end(r):1==arguments.length?new t.Request("GET",e):new t.Request(e,r)};t.Request=l,i.getXHR=function(){if(!(!r.XMLHttpRequest||r.location&&"file:"==r.location.protocol&&r.ActiveXObject))return new XMLHttpRequest;try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(e){}try{return new ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(e){}try{return new ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(e){}try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(e){}throw Error("Browser-only version of superagent could not find XHR")};var o="".trim?function(e){return e.trim()}:function(e){return e.replace(/(^\s*|\s*$)/g,"")};function a(e){if(!pt(e))return e;var t=[];for(var r in e)s(t,r,e[r]);return t.join("&")}function s(e,t,r){if(null!=r)if(Array.isArray(r))r.forEach(function(r){s(e,t,r)});else if(pt(r))for(var n in r)s(e,t+"["+n+"]",r[n]);else e.push(encodeURIComponent(t)+"="+encodeURIComponent(r));else null===r&&e.push(encodeURIComponent(t))}function u(e){for(var t,r,n={},i=e.split("&"),o=0,a=i.length;a>o;++o)-1==(r=(t=i[o]).indexOf("="))?n[decodeURIComponent(t)]="":n[decodeURIComponent(t.slice(0,r))]=decodeURIComponent(t.slice(r+1));return n}function c(e){return/[\/+]json($|[^-\w])/.test(e)}function p(e){this.req=e,this.xhr=this.req.xhr,this.text="HEAD"!=this.req.method&&(""===this.xhr.responseType||"text"===this.xhr.responseType)||void 0===this.xhr.responseType?this.xhr.responseText:null,this.statusText=this.req.xhr.statusText;var t=this.xhr.status;1223===t&&(t=204),this._setStatusProperties(t),this.header=this.headers=function(e){for(var t,r,n,i,a=e.split(/\r?\n/),s={},u=0,c=a.length;c>u;++u)-1!==(t=(r=a[u]).indexOf(":"))&&(n=r.slice(0,t).toLowerCase(),i=o(r.slice(t+1)),s[n]=i);return s}(this.xhr.getAllResponseHeaders()),this.header["content-type"]=this.xhr.getResponseHeader("content-type"),this._setHeaderProperties(this.header),this.body=null===this.text&&e._responseType?this.xhr.response:"HEAD"!=this.req.method?this._parseBody(this.text?this.text:this.xhr.response):null}function l(e,t){var r=this;this._query=this._query||[],this.method=e,this.url=t,this.header={},this._header={},this.on("end",function(){var e,t=null,n=null;try{n=new p(r)}catch(e){return(t=Error("Parser is unable to parse the response")).parse=!0,t.original=e,r.xhr?(t.rawResponse=void 0===r.xhr.responseType?r.xhr.responseText:r.xhr.response,t.status=r.xhr.status?r.xhr.status:null,t.statusCode=t.status):(t.rawResponse=null,t.status=null),r.callback(t)}r.emit("response",n);try{r._isResponseOK(n)||(e=Error(n.statusText||"Unsuccessful HTTP response"))}catch(t){e=t}e?(e.original=t,e.response=n,e.status=n.status,r.callback(e,n)):r.callback(null,n)})}function f(e,t,r){var n=i("DELETE",e);return"function"==typeof t&&(r=t,t=null),t&&n.send(t),r&&n.end(r),n}i.serializeObject=a,i.parseString=u,i.types={html:"text/html",json:"application/json",xml:"text/xml",urlencoded:"application/x-www-form-urlencoded",form:"application/x-www-form-urlencoded","form-data":"application/x-www-form-urlencoded"},i.serialize={"application/x-www-form-urlencoded":a,"application/json":JSON.stringify},i.parse={"application/x-www-form-urlencoded":u,"application/json":JSON.parse},vt(p.prototype),p.prototype._parseBody=function(e){var t=i.parse[this.type];return this.req._parser?this.req._parser(this,e):(!t&&c(this.type)&&(t=i.parse["application/json"]),t&&e&&(e.length||e instanceof Object)?t(e):null)},p.prototype.toError=function(){var e=this.req,t=e.method,r=e.url,n=Error("cannot "+t+" "+r+" ("+this.status+")");return n.status=this.status,n.method=t,n.url=r,n},i.Response=p,ct(l.prototype),lt(l.prototype),l.prototype.type=function(e){return this.set("Content-Type",i.types[e]||e),this},l.prototype.accept=function(e){return this.set("Accept",i.types[e]||e),this},l.prototype.auth=function(e,t,r){1===arguments.length&&(t=""),"object"==typeof t&&null!==t&&(r=t,t=""),r||(r={type:"function"==typeof btoa?"basic":"auto"});return this._auth(e,t,r,function(e){if("function"==typeof btoa)return btoa(e);throw Error("Cannot use basic auth, btoa is not a function")})},l.prototype.query=function(e){return"string"!=typeof e&&(e=a(e)),e&&this._query.push(e),this},l.prototype.attach=function(e,t,r){if(t){if(this._data)throw Error("superagent can't mix .send() and .attach()");this._getFormData().append(e,t,r||t.name)}return this},l.prototype._getFormData=function(){return this._formData||(this._formData=new r.FormData),this._formData},l.prototype.callback=function(e,t){if(this._shouldRetry(e,t))return this._retry();var r=this._callback;this.clearTimeout(),e&&(this._maxRetries&&(e.retries=this._retries-1),this.emit("error",e)),r(e,t)},l.prototype.crossDomainError=function(){var e=Error("Request has been terminated\nPossible causes: the network is offline, Origin is not allowed by Access-Control-Allow-Origin, the page is being unloaded, etc.");e.crossDomain=!0,e.status=this.status,e.method=this.method,e.url=this.url,this.callback(e)},l.prototype.buffer=l.prototype.ca=l.prototype.agent=function(){return console.warn("This is not supported in browser version of superagent"),this},l.prototype.pipe=l.prototype.write=function(){throw Error("Streaming is not supported in browser version of superagent")},l.prototype._isHost=function(e){return e&&"object"==typeof e&&!Array.isArray(e)&&"[object Object]"!==Object.prototype.toString.call(e)},l.prototype.end=function(e){return this._endCalled&&console.warn("Warning: .end() was called twice. This is not supported in superagent"),this._endCalled=!0,this._callback=e||n,this._finalizeQueryString(),this._end()},l.prototype._end=function(){var e=this,t=this.xhr=i.getXHR(),r=this._formData||this._data;this._setTimeouts(),t.onreadystatechange=function(){var r=t.readyState;if(r>=2&&e._responseTimeoutTimer&&clearTimeout(e._responseTimeoutTimer),4==r){var n;try{n=t.status}catch(e){n=0}if(!n){if(e.timedout||e._aborted)return;return e.crossDomainError()}e.emit("end")}};var n=function(t,r){r.total>0&&(r.percent=r.loaded/r.total*100),r.direction=t,e.emit("progress",r)};if(this.hasListeners("progress"))try{t.onprogress=n.bind(null,"download"),t.upload&&(t.upload.onprogress=n.bind(null,"upload"))}catch(e){}try{this.username&&this.password?t.open(this.method,this.url,!0,this.username,this.password):t.open(this.method,this.url,!0)}catch(e){return this.callback(e)}if(this._withCredentials&&(t.withCredentials=!0),!this._formData&&"GET"!=this.method&&"HEAD"!=this.method&&"string"!=typeof r&&!this._isHost(r)){var o=this._header["content-type"],a=this._serializer||i.serialize[o?o.split(";")[0]:""];!a&&c(o)&&(a=i.serialize["application/json"]),a&&(r=a(r))}for(var s in this.header)null!=this.header[s]&&this.header.hasOwnProperty(s)&&t.setRequestHeader(s,this.header[s]);return this._responseType&&(t.responseType=this._responseType),this.emit("request",this),t.send(void 0!==r?r:null),this},i.agent=function(){return new wt},["GET","POST","OPTIONS","PATCH","PUT","DELETE"].forEach(function(e){wt.prototype[e.toLowerCase()]=function(t,r){var n=new i.Request(e,t);return this._setDefaults(n),r&&n.end(r),n}}),wt.prototype.del=wt.prototype.delete,i.get=function(e,t,r){var n=i("GET",e);return"function"==typeof t&&(r=t,t=null),t&&n.query(t),r&&n.end(r),n},i.head=function(e,t,r){var n=i("HEAD",e);return"function"==typeof t&&(r=t,t=null),t&&n.query(t),r&&n.end(r),n},i.options=function(e,t,r){var n=i("OPTIONS",e);return"function"==typeof t&&(r=t,t=null),t&&n.send(t),r&&n.end(r),n},i.del=f,i.delete=f,i.patch=function(e,t,r){var n=i("PATCH",e);return"function"==typeof t&&(r=t,t=null),t&&n.send(t),r&&n.end(r),n},i.post=function(e,t,r){var n=i("POST",e);return"function"==typeof t&&(r=t,t=null),t&&n.send(t),r&&n.end(r),n},i.put=function(e,t,r){var n=i("PUT",e);return"function"==typeof t&&(r=t,t=null),t&&n.send(t),r&&n.end(r),n}}),_t=Object.freeze({default:kt,__moduleExports:kt,get:kt.get,post:kt.post,put:kt.put,delete:kt.delete,head:kt.head,Request:kt.Request}),xt=function(e,t){return _t[e](t).set("Filestack-Source","JS-1.4.0")},Et=_t,At=function(){return function(e,t,r,n){this.resolve=e,this.fn=t,this.self=r||null,this.args=n}}(),Tt=function(){function e(){this._s1=[],this._s2=[]}return e.prototype.push=function(e){this._s1.push(e)},e.prototype.shift=function(){var e=this._s2;if(0===e.length){var t=this._s1;if(0===t.length)return;this._s1=e,e=this._s2=t.reverse()}return e.pop()},e.prototype.isEmpty=function(){return!this._s1.length&&!this._s2.length},e}();var Ot,Pt,St=function(e,t){var r=new Tt;function n(t,n,o){if(e){e--;var a=new Promise(function(e){e(t.apply(n,o))});return a.then(i,i),a}return new Promise(function(e){r.push(new At(e,t,n,o))})}function i(){if(e++,!r.isEmpty()){var t=r.shift();t.resolve(n(t.fn,t.self,t.args))}}if(void 0!==t&&"function"!=typeof t)throw new TypeError("Expected throat fn to be a function but got "+typeof t);return function(){for(var e=[],r=0;arguments.length>r;r++)e[r]=arguments[r];return n(t,this,e)}},It=function(e,t,r){void 0===r&&(r={});var n=Object.keys(r),i=t.map(function(e){return e.name}),o=i.join(", ");return n.forEach(function(t){if(0>i.indexOf(t))throw Error(t+" is not a valid option for "+e+". Valid options are: "+o)}),t.forEach(function(e){var t=r[e.name];if("location"===e.name&&"string"==typeof t&&(t=t.toLowerCase()),void 0!==t){var n=it(t,e.type);if(!n.isValid()){var i=n.firstError();if(i&&i.message)throw Error(i.message)}}}),n},jt=function(e){var t=r({},e);return Object.keys(t).forEach(function(e){return!t[e]&&void 0!==t[e]&&delete t[e]}),t},Ct=function(e,t,r){var n=!1,i=!1;return function(){for(var o=[],a=0;arguments.length>a;a++)o[a]=arguments[a];i=!!r&&!n;var s=this;if(n||(n=!0,setTimeout(function(){if(n=!1,!r)return e.apply(s,o)},t)),i)return i=!1,e.apply(this,arguments)}},Bt=function(e,t,r,n){if(!t||"string"!=typeof t)throw Error("A valid Filestack handle is required for remove");if(!(e.policy&&e.signature||n&&n.policy&&n.signature))throw Error("Security policy and signature are required for remove");var i=e.urls.fileApiUrl+"/"+t,o={key:e.apikey,policy:n&&n.policy||e.policy,signature:n&&n.signature||e.signature};return r&&(o.skip_storage=!0),new Promise(function(e,t){Et.delete(i).query(o).end(function(r,n){r?t(r):e(n)})})};!function(e){e.get="get",e.head="head"}(Ot||(Ot={})),function(e){e.blob="blob",e.json="json"}(Pt||(Pt={}));var zt,Nt,Rt,Ut,qt,Dt,Mt,Ft,$t,Lt,Ht,Vt,Xt,Wt=function(e){for(var t={},r=Object.keys(e),n=0;r.length>n;n++){var i=r[n].split(/(?=[A-Z])/).join("_").toLowerCase();t[i]="object"!=typeof e[r[n]]||Array.isArray(e[r[n]])?e[r[n]]:Wt(e[r[n]])}return t};(zt=e.EAlignOptions||(e.EAlignOptions={})).left="left",zt.right="right",zt.center="center",zt.bottom="bottom",zt.top="top",(Nt=e.EAlignFacesOptions||(e.EAlignFacesOptions={})).left="left",Nt.right="right",Nt.center="center",Nt.bottom="bottom",Nt.top="top",Nt.faces="faces",(Rt=e.EFitOptions||(e.EFitOptions={})).clip="clip",Rt.crop="crop",Rt.scale="scale",Rt.max="max",(Ut=e.EBlurMode||(e.EBlurMode={})).linear="linear",Ut.gaussian="gaussian",(qt=e.EShapeType||(e.EShapeType={})).oval="oval",qt.rect="rect",(Dt=e.ENoiseType||(e.ENoiseType={})).none="none",Dt.low="low",Dt.medium="medium",Dt.high="high",(Mt=e.EStyleType||(e.EStyleType={})).artwork="artwork",Mt.photo="photo",(Ft=e.EColorspaceType||(e.EColorspaceType={})).RGB="RGB",Ft.CMYK="CMYK",Ft.Input="Input",($t=e.ECropfacesType||(e.ECropfacesType={})).thumb="thumb",$t.crop="crop",$t.fill="fill",function(e){e.h264="h264",e.h264_hi="h264.hi",e.webm="webm",e["webm-hi"]="webm.hi",e.ogg="ogg",e["ogg-hi"]="ogg.hi",e["hls-variant"]="hls.variant",e.mp3="mp3",e.oga="oga",e.m4a="m4a",e.aac="aac",e.hls="hls.variant.audio"}(Lt||(Lt={})),function(e){e.s3="s3",e.azure="azure",e.gcs="gcs",e.rackspace="rackspace",e.dropbox="dropbox"}(Ht||(Ht={})),function(e){e.private="private",e.public="public"}(Vt||(Vt={})),function(e){e.preserve="preserve",e.constrain="constrain",e.letterbox="letterbox",e.pad="pad",e.crop="crop"}(Xt||(Xt={}));var Gt=function(e,t){var r=et(Ke,function(r){return r>=e&&t>=r});return r.displayName="Value is not in allowed range("+e+"-"+t+")",r},Jt=function(e,t){return tt([et(Ze,function(e){return e>0&&1>e}),Gt(e,t)])},Kt=function(){return tt([Ke,Ye.of("all")])},Zt=Ye.of("top left right bottom center"),Qt=Ye.of("linear gaussian"),Yt=Qe,er=tt([Ye.of("exif"),Gt(1,359)]),tr=Ye.of("rect oval"),rr=Ye.of("clip crop scale max"),nr=Ye.of("RGB CMYK Input"),ir=Ye.of("thumb crop fill"),or=function(e,t,r){if(void 0===t&&(t=!1),void 0===r&&(r=!1),"function"==typeof e)return r?ot(e):e;var n=nt(e);if(!t)return r?ot(n):n;var i=Ge,o=tt([i,n],"canBeBoolean");return o.dispatch=function(e){return"boolean"==typeof e?i:n},r?ot(o):o},ar=function(e){var t={};return Array.isArray(e)||"object"!=typeof e?(e.forEach(function(e){t[e.name]=or(e.props?ar(e.props):e.validator,e.canBeBoolean,!e.required)}),nt(t)):(Object.keys(e).map(function(r){t[r]=ot(e[r])}),t)},sr=[{name:"flip",validator:Ge},{name:"compress",validator:Ge},{name:"flop",validator:Ge},{name:"tags",validator:Ge},{name:"sfw",validator:Ge},{name:"monochrome",validator:Ge},{name:"enhance",validator:Ge},{name:"redeye",validator:Ge},{name:"negative",validator:Ge},{name:"resize",props:{width:Ke,height:Ke,fit:rr,align:Zt}},{name:"crop",props:{dim:rt([Ke,Ke,Ke,Ke])}},{name:"resize",props:{width:Ke,height:Ke,fit:rr,align:Zt}},{name:"rotate",props:{deg:er,colour:Yt,background:Yt}},{name:"rounded_corners",canBeBoolean:!0,props:{radius:Gt(1,1e4),blur:Gt(0,20),background:Yt}},{name:"vignette",props:{amount:Gt(0,100),blurmode:Qt,background:Yt}},{name:"polaroid",canBeBoolean:!0,props:{color:Yt,rotate:er,background:Yt}},{name:"torn_edges",canBeBoolean:!0,props:{spread:rt([Gt(1,1e4),Gt(1,1e4)]),background:Yt}},{name:"shadow",canBeBoolean:!0,props:{blur:Gt(0,20),opacity:Gt(0,100),vector:rt([Gt(-1e3,1e3),Gt(-1e3,1e3)]),color:Yt,background:Yt}},{name:"circle",canBeBoolean:!0,props:{background:Yt}},{name:"border",canBeBoolean:!0,props:{width:Gt(1,1e3),color:Yt,background:Yt}},{name:"sharpen",canBeBoolean:!0,props:{amount:Gt(1,20)}},{name:"blackwhite",canBeBoolean:!0,props:{threshold:Gt(0,100)}},{name:"blur",canBeBoolean:!0,props:[{name:"amount",validator:Gt(2,20),required:!0}]},{name:"sepia",canBeBoolean:!0,props:{tone:Gt(1,100)}},{name:"pixelate",canBeBoolean:!0,props:[{name:"amount",validator:Gt(2,100),required:!0}]},{name:"oil_paint",canBeBoolean:!0,props:{amount:Gt(1,10)}},{name:"modulate",canBeBoolean:!0,props:{brightness:Gt(0,1e4),hue:Gt(0,359),saturation:Gt(0,1e4)}},{name:"partial_pixelate",props:{amount:Gt(2,100),blur:Gt(0,20),type:tr,objects:at(rt([Ke,Ke,Ke,Ke]))}},{name:"partial_blur",props:{amount:Gt(2,100),blur:Gt(0,20),type:tr,objects:at(rt([Ke,Ke,Ke,Ke]))}},{name:"collage",props:{files:at(Qe),margin:Ke,width:Ke,height:Ke,color:Yt,fit:rr,autorotate:Ge}},{name:"upscale",canBeBoolean:!0,props:{upscale:Ge,noise:Ye.of("none low medium high"),style:Ye.of("artwork photo")}},{name:"ascii",canBeBoolean:!0,props:{background:Yt,foreground:Yt,colored:Ge,size:Gt(10,100),reverse:Ge}},{name:"quality",props:{value:Ze}},{name:"security",props:{policy:Qe,signature:Qe}},{name:"cache",canBeBoolean:!0,props:{cache:Ge,expiry:Ke}},{name:"output",props:{format:Qe,colorspace:nr,strip:Ge,quality:Gt(1,100),page:Gt(1,1e4),compress:Ge,density:Gt(1,500),background:Yt,secure:Ge,docinfo:Ge,pageformat:Ye.of("a3 A3 a4 A4 a5 A5 b4 B4 b5 B5 letter legal tabloid"),pageorientation:Ye.of("portrait landscape")}},{name:"crop_faces",props:{mode:ir,width:Ke,height:Ke,faces:Kt(),buffer:Ke}},{name:"detect_faces",canBeBoolean:!0,props:{minsize:Jt(0,1e4),maxsize:Jt(0,1e4),color:Yt,export:Ge}},{name:"pixelate_faces",props:{faces:Kt(),minsize:Jt(0,1e4),maxsize:Jt(0,1e4),buffer:Gt(0,1e3),amount:Gt(2,100),blur:Gt(0,20),type:tr}},{name:"blur_faces",props:{faces:Kt(),minsize:Jt(0,1e4),maxsize:Jt(0,1e4),buffer:Gt(0,1e3),amount:Gt(2,100),blur:Gt(0,20),type:tr}},{name:"video_convert",props:{preset:Ye.of("h264 h264.hi webm webm.hi ogg ogg.hi hls.variant mp3 oga m4a aac hls.variant.audio"),force:Ge,title:Qe,extname:Qe,filename:Qe,location:Ye.of("S3 s3 azure gcs rackspace dropbox"),path:Qe,access:Ye.of("private public"),container:Qe,audio_bitrate:Gt(0,999),video_bitrate:Gt(1,5e3),audio_sample_rate:Gt(0,99999),audio_channels:Gt(1,12),upscale:Ge,aspect_mode:Ye.of("preserve constrain letterbox pad crop"),clip_length:Qe,clip_offset:Qe,width:Ze,height:Ze,two_pass:Ge,fps:Gt(1,300),keyframe_interval:Gt(1,300),watermark_url:Qe,watermark_top:Ze,watermark_bottom:Ze,watermark_right:Ze,watermark_left:Ze,watermark_width:Ze,watermark_height:Ze}}],ur=function(e){return"["+e.map(function(e){return Array.isArray(e)?ur(e):e})+"]"},cr=function(e,t,r){void 0===r&&(r={}),r=Wt(r);var n=it(r,ar(sr),{strict:!0});if(!n.isValid()){var i=n.firstError();throw Error("Wrong options provided: "+(i?i.message:"unknown"))}var o=[];e.policy&&e.signature&&(r.security={policy:e.policy,signature:e.signature}),Object.keys(r).forEach(function(e){o.push(function(e,t){var r=[];return"boolean"==typeof t?t||"cache"!==e?t?e:"":e+"=false":"object"!=typeof t||Object.keys(t).length?(Object.keys(t).forEach(function(e){r.push(Array.isArray(t[e])?e+":"+ur(t[e]):e+":"+t[e])}),e+"="+r.join(",")):""}(e,r[e]))}),o=o.filter(function(e){return e.length});var a=function(e,t){var r=e.urls.processApiUrl,n=e.urls.cdnUrl;if(!t||0===t.length)return n;if(t.indexOf("http:")>-1||t.indexOf("https:")>-1){if(!e.apikey)throw Error("Api key is required when external url is provided");return r+"/"+e.apikey}if(t.indexOf("src:")>-1){if(!e.apikey)throw Error("Api key is required when storage alias is provided");return n+"/"+e.apikey}return n}(e,t);return o.length?a+"/"+o.join("/")+"/"+t:a+"/"+t},pr=ut(function(e){var t,r;t=st,r=function(){var e=!0;function t(t){function r(e){var r=t.match(e);return r&&r.length>1&&r[1]||""}function n(e){var r=t.match(e);return r&&r.length>1&&r[2]||""}var i,a=r(/(ipod|iphone|ipad)/i).toLowerCase(),s=!/like android/i.test(t)&&/android/i.test(t),u=/nexus\s*[0-6]\s*/i.test(t),c=!u&&/nexus\s*[0-9]+/i.test(t),p=/CrOS/.test(t),l=/silk/i.test(t),f=/sailfish/i.test(t),d=/tizen/i.test(t),h=/(web|hpw)(o|0)s/i.test(t),m=/windows phone/i.test(t),y=!m&&/windows/i.test(t),v=!a&&!l&&/macintosh/i.test(t),g=!s&&!f&&!d&&!h&&/linux/i.test(t),b=n(/edg([ea]|ios)\/(\d+(\.\d+)?)/i),w=r(/version\/(\d+(\.\d+)?)/i),k=/tablet/i.test(t)&&!/tablet pc/i.test(t),_=!k&&/[^-]mobi/i.test(t),x=/xbox/i.test(t);/opera/i.test(t)?i={name:"Opera",opera:e,version:w||r(/(?:opera|opr|opios)[\s\/](\d+(\.\d+)?)/i)}:/opr\/|opios/i.test(t)?i={name:"Opera",opera:e,version:r(/(?:opr|opios)[\s\/](\d+(\.\d+)?)/i)||w}:/SamsungBrowser/i.test(t)?i={name:"Samsung Internet for Android",samsungBrowser:e,version:w||r(/(?:SamsungBrowser)[\s\/](\d+(\.\d+)?)/i)}:/Whale/i.test(t)?i={name:"NAVER Whale browser",whale:e,version:r(/(?:whale)[\s\/](\d+(?:\.\d+)+)/i)}:/MZBrowser/i.test(t)?i={name:"MZ Browser",mzbrowser:e,version:r(/(?:MZBrowser)[\s\/](\d+(?:\.\d+)+)/i)}:/coast/i.test(t)?i={name:"Opera Coast",coast:e,version:w||r(/(?:coast)[\s\/](\d+(\.\d+)?)/i)}:/focus/i.test(t)?i={name:"Focus",focus:e,version:r(/(?:focus)[\s\/](\d+(?:\.\d+)+)/i)}:/yabrowser/i.test(t)?i={name:"Yandex Browser",yandexbrowser:e,version:w||r(/(?:yabrowser)[\s\/](\d+(\.\d+)?)/i)}:/ucbrowser/i.test(t)?i={name:"UC Browser",ucbrowser:e,version:r(/(?:ucbrowser)[\s\/](\d+(?:\.\d+)+)/i)}:/mxios/i.test(t)?i={name:"Maxthon",maxthon:e,version:r(/(?:mxios)[\s\/](\d+(?:\.\d+)+)/i)}:/epiphany/i.test(t)?i={name:"Epiphany",epiphany:e,version:r(/(?:epiphany)[\s\/](\d+(?:\.\d+)+)/i)}:/puffin/i.test(t)?i={name:"Puffin",puffin:e,version:r(/(?:puffin)[\s\/](\d+(?:\.\d+)?)/i)}:/sleipnir/i.test(t)?i={name:"Sleipnir",sleipnir:e,version:r(/(?:sleipnir)[\s\/](\d+(?:\.\d+)+)/i)}:/k-meleon/i.test(t)?i={name:"K-Meleon",kMeleon:e,version:r(/(?:k-meleon)[\s\/](\d+(?:\.\d+)+)/i)}:m?(i={name:"Windows Phone",osname:"Windows Phone",windowsphone:e},b?(i.msedge=e,i.version=b):(i.msie=e,i.version=r(/iemobile\/(\d+(\.\d+)?)/i))):/msie|trident/i.test(t)?i={name:"Internet Explorer",msie:e,version:r(/(?:msie |rv:)(\d+(\.\d+)?)/i)}:p?i={name:"Chrome",osname:"Chrome OS",chromeos:e,chromeBook:e,chrome:e,version:r(/(?:chrome|crios|crmo)\/(\d+(\.\d+)?)/i)}:/edg([ea]|ios)/i.test(t)?i={name:"Microsoft Edge",msedge:e,version:b}:/vivaldi/i.test(t)?i={name:"Vivaldi",vivaldi:e,version:r(/vivaldi\/(\d+(\.\d+)?)/i)||w}:f?i={name:"Sailfish",osname:"Sailfish OS",sailfish:e,version:r(/sailfish\s?browser\/(\d+(\.\d+)?)/i)}:/seamonkey\//i.test(t)?i={name:"SeaMonkey",seamonkey:e,version:r(/seamonkey\/(\d+(\.\d+)?)/i)}:/firefox|iceweasel|fxios/i.test(t)?(i={name:"Firefox",firefox:e,version:r(/(?:firefox|iceweasel|fxios)[ \/](\d+(\.\d+)?)/i)},/\((mobile|tablet);[^\)]*rv:[\d\.]+\)/i.test(t)&&(i.firefoxos=e,i.osname="Firefox OS")):l?i={name:"Amazon Silk",silk:e,version:r(/silk\/(\d+(\.\d+)?)/i)}:/phantom/i.test(t)?i={name:"PhantomJS",phantom:e,version:r(/phantomjs\/(\d+(\.\d+)?)/i)}:/slimerjs/i.test(t)?i={name:"SlimerJS",slimer:e,version:r(/slimerjs\/(\d+(\.\d+)?)/i)}:/blackberry|\bbb\d+/i.test(t)||/rim\stablet/i.test(t)?i={name:"BlackBerry",osname:"BlackBerry OS",blackberry:e,version:w||r(/blackberry[\d]+\/(\d+(\.\d+)?)/i)}:h?(i={name:"WebOS",osname:"WebOS",webos:e,version:w||r(/w(?:eb)?osbrowser\/(\d+(\.\d+)?)/i)},/touchpad\//i.test(t)&&(i.touchpad=e)):/bada/i.test(t)?i={name:"Bada",osname:"Bada",bada:e,version:r(/dolfin\/(\d+(\.\d+)?)/i)}:d?i={name:"Tizen",osname:"Tizen",tizen:e,version:r(/(?:tizen\s?)?browser\/(\d+(\.\d+)?)/i)||w}:/qupzilla/i.test(t)?i={name:"QupZilla",qupzilla:e,version:r(/(?:qupzilla)[\s\/](\d+(?:\.\d+)+)/i)||w}:/chromium/i.test(t)?i={name:"Chromium",chromium:e,version:r(/(?:chromium)[\s\/](\d+(?:\.\d+)?)/i)||w}:/chrome|crios|crmo/i.test(t)?i={name:"Chrome",chrome:e,version:r(/(?:chrome|crios|crmo)\/(\d+(\.\d+)?)/i)}:s?i={name:"Android",version:w}:/safari|applewebkit/i.test(t)?(i={name:"Safari",safari:e},w&&(i.version=w)):a?(i={name:"iphone"==a?"iPhone":"ipad"==a?"iPad":"iPod"},w&&(i.version=w)):i=/googlebot/i.test(t)?{name:"Googlebot",googlebot:e,version:r(/googlebot\/(\d+(\.\d+))/i)||w}:{name:r(/^(.*)\/(.*) /),version:n(/^(.*)\/(.*) /)},!i.msedge&&/(apple)?webkit/i.test(t)?(/(apple)?webkit\/537\.36/i.test(t)?(i.name=i.name||"Blink",i.blink=e):(i.name=i.name||"Webkit",i.webkit=e),!i.version&&w&&(i.version=w)):!i.opera&&/gecko\//i.test(t)&&(i.name=i.name||"Gecko",i.gecko=e,i.version=i.version||r(/gecko\/(\d+(\.\d+)?)/i)),i.windowsphone||!s&&!i.silk?!i.windowsphone&&a?(i[a]=e,i.ios=e,i.osname="iOS"):v?(i.mac=e,i.osname="macOS"):x?(i.xbox=e,i.osname="Xbox"):y?(i.windows=e,i.osname="Windows"):g&&(i.linux=e,i.osname="Linux"):(i.android=e,i.osname="Android");var E="";i.windows?E=function(e){switch(e){case"NT":return"NT";case"XP":return"XP";case"NT 5.0":return"2000";case"NT 5.1":return"XP";case"NT 5.2":return"2003";case"NT 6.0":return"Vista";case"NT 6.1":return"7";case"NT 6.2":return"8";case"NT 6.3":return"8.1";case"NT 10.0":return"10";default:return}}(r(/Windows ((NT|XP)( \d\d?.\d)?)/i)):i.windowsphone?E=r(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i):i.mac?E=(E=r(/Mac OS X (\d+([_\.\s]\d+)*)/i)).replace(/[_\s]/g,"."):a?E=(E=r(/os (\d+([_\s]\d+)*) like mac os x/i)).replace(/[_\s]/g,"."):s?E=r(/android[ \/-](\d+(\.\d+)*)/i):i.webos?E=r(/(?:web|hpw)os\/(\d+(\.\d+)*)/i):i.blackberry?E=r(/rim\stablet\sos\s(\d+(\.\d+)*)/i):i.bada?E=r(/bada\/(\d+(\.\d+)*)/i):i.tizen&&(E=r(/tizen[\/\s](\d+(\.\d+)*)/i)),E&&(i.osversion=E);var A=!i.windows&&E.split(".")[0];return k||c||"ipad"==a||s&&(3==A||A>=4&&!_)||i.silk?i.tablet=e:(_||"iphone"==a||"ipod"==a||s||u||i.blackberry||i.webos||i.bada)&&(i.mobile=e),i.msedge||i.msie&&i.version>=10||i.yandexbrowser&&i.version>=15||i.vivaldi&&i.version>=1||i.chrome&&i.version>=20||i.samsungBrowser&&i.version>=4||i.whale&&1===o([i.version,"1.0"])||i.mzbrowser&&1===o([i.version,"6.0"])||i.focus&&1===o([i.version,"1.0"])||i.firefox&&i.version>=20||i.safari&&i.version>=6||i.opera&&i.version>=10||i.ios&&i.osversion&&i.osversion.split(".")[0]>=6||i.blackberry&&i.version>=10.1||i.chromium&&i.version>=20?i.a=e:i.msie&&10>i.version||i.chrome&&20>i.version||i.firefox&&20>i.version||i.safari&&6>i.version||i.opera&&10>i.version||i.ios&&i.osversion&&6>i.osversion.split(".")[0]||i.chromium&&20>i.version?i.c=e:i.x=e,i}var r=t("undefined"!=typeof navigator&&navigator.userAgent||"");function n(e){return e.split(".").length}function i(e,t){var r,n=[];if(Array.prototype.map)return Array.prototype.map.call(e,t);for(r=0;e.length>r;r++)n.push(t(e[r]));return n}function o(e){for(var t=Math.max(n(e[0]),n(e[1])),r=i(e,function(e){var r=t-n(e);return i((e+=Array(r+1).join(".0")).split("."),function(e){return Array(20-e.length).join("0")+e}).reverse()});--t>=0;){if(r[0][t]>r[1][t])return 1;if(r[0][t]!==r[1][t])return-1;if(0===t)return 0}}function a(e,n,i){var a=r;"string"==typeof n&&(i=n,n=void 0),void 0===n&&(n=!1),i&&(a=t(i));var s=""+a.version;for(var u in e)if(e.hasOwnProperty(u)&&a[u]){if("string"!=typeof e[u])throw Error("Browser version in the minVersion map should be a string: "+u+": "+e);return 0>o([s,e[u]])}return n}return r.test=function(e){for(var t=0;e.length>t;++t){var n=e[t];if("string"==typeof n&&n in r)return!0}return!1},r.isUnsupportedBrowser=a,r.compareVersions=o,r.check=function(e,t,r){return!a(e,t,r)},r._detect=t,r.detect=t,r},e.exports?e.exports=r():t.bowser=r()}).mobile;var lr,fr,dr,hr={atob:function(e){if((e=(e+="").replace(/[ \t\n\f\r]/g,"")).length%4==0&&/==?$/.test(e)&&(e=e.replace(/==?$/,"")),e.length%4==1||!/^[+/0-9A-Za-z]*$/.test(e))return null;for(var t="",r=0,n=0,i=0;e.length>i;i++)r<<=6,r|=(o=e[i],/[A-Z]/.test(o)?o.charCodeAt(0)-65:/[a-z]/.test(o)?o.charCodeAt(0)-97+26:/[0-9]/.test(o)?o.charCodeAt(0)-48+52:"+"==o?62:"/"==o?63:void 0),24==(n+=6)&&(t+=String.fromCharCode((16711680&r)>>16),t+=String.fromCharCode((65280&r)>>8),t+=String.fromCharCode(255&r),r=n=0);var o;return 12==n?t+=String.fromCharCode(r>>=4):18==n&&(t+=String.fromCharCode((65280&(r>>=2))>>8),t+=String.fromCharCode(255&r)),t},btoa:function(e){var t;for(e+="",t=0;e.length>t;t++)if(e.charCodeAt(t)>255)return null;var r="";for(t=0;e.length>t;t+=3){var n=[void 0,void 0,void 0,void 0];n[0]=e.charCodeAt(t)>>2,n[1]=(3&e.charCodeAt(t))<<4,e.length>t+1&&(n[1]|=e.charCodeAt(t+1)>>4,n[2]=(15&e.charCodeAt(t+1))<<2),e.length>t+2&&(n[2]|=e.charCodeAt(t+2)>>6,n[3]=63&e.charCodeAt(t+2));for(var i=0;n.length>i;i++)r+=void 0===n[i]?"=":26>(o=n[i])?String.fromCharCode(o+65):52>o?String.fromCharCode(o-26+97):62>o?String.fromCharCode(o-52+48):62==o?"+":63==o?"/":void 0}var o;return r}},mr=hr.atob,yr=hr.btoa,vr=ut(function(e,t){e.exports=function(e){var t=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function r(e,t){var r=e[0],n=e[1],i=e[2],o=e[3];n=((n+=((i=((i+=((o=((o+=((r=((r+=(n&i|~n&o)+t[0]-680876936|0)<<7|r>>>25)+n|0)&n|~r&i)+t[1]-389564586|0)<<12|o>>>20)+r|0)&r|~o&n)+t[2]+606105819|0)<<17|i>>>15)+o|0)&o|~i&r)+t[3]-1044525330|0)<<22|n>>>10)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n&i|~n&o)+t[4]-176418897|0)<<7|r>>>25)+n|0)&n|~r&i)+t[5]+1200080426|0)<<12|o>>>20)+r|0)&r|~o&n)+t[6]-1473231341|0)<<17|i>>>15)+o|0)&o|~i&r)+t[7]-45705983|0)<<22|n>>>10)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n&i|~n&o)+t[8]+1770035416|0)<<7|r>>>25)+n|0)&n|~r&i)+t[9]-1958414417|0)<<12|o>>>20)+r|0)&r|~o&n)+t[10]-42063|0)<<17|i>>>15)+o|0)&o|~i&r)+t[11]-1990404162|0)<<22|n>>>10)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n&i|~n&o)+t[12]+1804603682|0)<<7|r>>>25)+n|0)&n|~r&i)+t[13]-40341101|0)<<12|o>>>20)+r|0)&r|~o&n)+t[14]-1502002290|0)<<17|i>>>15)+o|0)&o|~i&r)+t[15]+1236535329|0)<<22|n>>>10)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n&o|i&~o)+t[1]-165796510|0)<<5|r>>>27)+n|0)&i|n&~i)+t[6]-1069501632|0)<<9|o>>>23)+r|0)&n|r&~n)+t[11]+643717713|0)<<14|i>>>18)+o|0)&r|o&~r)+t[0]-373897302|0)<<20|n>>>12)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n&o|i&~o)+t[5]-701558691|0)<<5|r>>>27)+n|0)&i|n&~i)+t[10]+38016083|0)<<9|o>>>23)+r|0)&n|r&~n)+t[15]-660478335|0)<<14|i>>>18)+o|0)&r|o&~r)+t[4]-405537848|0)<<20|n>>>12)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n&o|i&~o)+t[9]+568446438|0)<<5|r>>>27)+n|0)&i|n&~i)+t[14]-1019803690|0)<<9|o>>>23)+r|0)&n|r&~n)+t[3]-187363961|0)<<14|i>>>18)+o|0)&r|o&~r)+t[8]+1163531501|0)<<20|n>>>12)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n&o|i&~o)+t[13]-1444681467|0)<<5|r>>>27)+n|0)&i|n&~i)+t[2]-51403784|0)<<9|o>>>23)+r|0)&n|r&~n)+t[7]+1735328473|0)<<14|i>>>18)+o|0)&r|o&~r)+t[12]-1926607734|0)<<20|n>>>12)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n^i^o)+t[5]-378558|0)<<4|r>>>28)+n|0)^n^i)+t[8]-2022574463|0)<<11|o>>>21)+r|0)^r^n)+t[11]+1839030562|0)<<16|i>>>16)+o|0)^o^r)+t[14]-35309556|0)<<23|n>>>9)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n^i^o)+t[1]-1530992060|0)<<4|r>>>28)+n|0)^n^i)+t[4]+1272893353|0)<<11|o>>>21)+r|0)^r^n)+t[7]-155497632|0)<<16|i>>>16)+o|0)^o^r)+t[10]-1094730640|0)<<23|n>>>9)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n^i^o)+t[13]+681279174|0)<<4|r>>>28)+n|0)^n^i)+t[0]-358537222|0)<<11|o>>>21)+r|0)^r^n)+t[3]-722521979|0)<<16|i>>>16)+o|0)^o^r)+t[6]+76029189|0)<<23|n>>>9)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n^i^o)+t[9]-640364487|0)<<4|r>>>28)+n|0)^n^i)+t[12]-421815835|0)<<11|o>>>21)+r|0)^r^n)+t[15]+530742520|0)<<16|i>>>16)+o|0)^o^r)+t[2]-995338651|0)<<23|n>>>9)+i|0,n=((n+=((o=((o+=(n^((r=((r+=(i^(n|~o))+t[0]-198630844|0)<<6|r>>>26)+n|0)|~i))+t[7]+1126891415|0)<<10|o>>>22)+r|0)^((i=((i+=(r^(o|~n))+t[14]-1416354905|0)<<15|i>>>17)+o|0)|~r))+t[5]-57434055|0)<<21|n>>>11)+i|0,n=((n+=((o=((o+=(n^((r=((r+=(i^(n|~o))+t[12]+1700485571|0)<<6|r>>>26)+n|0)|~i))+t[3]-1894986606|0)<<10|o>>>22)+r|0)^((i=((i+=(r^(o|~n))+t[10]-1051523|0)<<15|i>>>17)+o|0)|~r))+t[1]-2054922799|0)<<21|n>>>11)+i|0,n=((n+=((o=((o+=(n^((r=((r+=(i^(n|~o))+t[8]+1873313359|0)<<6|r>>>26)+n|0)|~i))+t[15]-30611744|0)<<10|o>>>22)+r|0)^((i=((i+=(r^(o|~n))+t[6]-1560198380|0)<<15|i>>>17)+o|0)|~r))+t[13]+1309151649|0)<<21|n>>>11)+i|0,n=((n+=((o=((o+=(n^((r=((r+=(i^(n|~o))+t[4]-145523070|0)<<6|r>>>26)+n|0)|~i))+t[11]-1120210379|0)<<10|o>>>22)+r|0)^((i=((i+=(r^(o|~n))+t[2]+718787259|0)<<15|i>>>17)+o|0)|~r))+t[9]-343485551|0)<<21|n>>>11)+i|0,e[0]=r+e[0]|0,e[1]=n+e[1]|0,e[2]=i+e[2]|0,e[3]=o+e[3]|0}function n(e){var t,r=[];for(t=0;64>t;t+=4)r[t>>2]=e.charCodeAt(t)+(e.charCodeAt(t+1)<<8)+(e.charCodeAt(t+2)<<16)+(e.charCodeAt(t+3)<<24);return r}function i(e){var t,r=[];for(t=0;64>t;t+=4)r[t>>2]=e[t]+(e[t+1]<<8)+(e[t+2]<<16)+(e[t+3]<<24);return r}function o(e){var t,i,o,a,s,u,c=e.length,p=[1732584193,-271733879,-1732584194,271733878];for(t=64;c>=t;t+=64)r(p,n(e.substring(t-64,t)));for(e=e.substring(t-64),i=e.length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],t=0;i>t;t+=1)o[t>>2]|=e.charCodeAt(t)<<(t%4<<3);if(o[t>>2]|=128<<(t%4<<3),t>55)for(r(p,o),t=0;16>t;t+=1)o[t]=0;return a=(a=8*c).toString(16).match(/(.*?)(.{0,8})$/),s=parseInt(a[2],16),u=parseInt(a[1],16)||0,o[14]=s,o[15]=u,r(p,o),p}function a(e){var r,n="";for(r=0;4>r;r+=1)n+=t[e>>8*r+4&15]+t[e>>8*r&15];return n}function s(e){var t;for(t=0;e.length>t;t+=1)e[t]=a(e[t]);return e.join("")}function u(e){return/[\u0080-\uFFFF]/.test(e)&&(e=unescape(encodeURIComponent(e))),e}function c(e){var t,r=[],n=e.length;for(t=0;n-1>t;t+=2)r.push(parseInt(e.substr(t,2),16));return String.fromCharCode.apply(String,r)}function p(){this.reset()}return s(o("hello")),"undefined"==typeof ArrayBuffer||ArrayBuffer.prototype.slice||function(){function t(e,t){return 0>(e=0|e||0)?Math.max(e+t,0):Math.min(e,t)}ArrayBuffer.prototype.slice=function(r,n){var i,o,a,s,u=this.byteLength,c=t(r,u),p=u;return n!==e&&(p=t(n,u)),c>p?new ArrayBuffer(0):(i=p-c,o=new ArrayBuffer(i),a=new Uint8Array(o),s=new Uint8Array(this,c,i),a.set(s),o)}}(),p.prototype.append=function(e){return this.appendBinary(u(e)),this},p.prototype.appendBinary=function(e){this._buff+=e,this._length+=e.length;var t,i=this._buff.length;for(t=64;i>=t;t+=64)r(this._hash,n(this._buff.substring(t-64,t)));return this._buff=this._buff.substring(t-64),this},p.prototype.end=function(e){var t,r,n=this._buff,i=n.length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;i>t;t+=1)o[t>>2]|=n.charCodeAt(t)<<(t%4<<3);return this._finish(o,i),r=s(this._hash),e&&(r=c(r)),this.reset(),r},p.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},p.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash}},p.prototype.setState=function(e){return this._buff=e.buff,this._length=e.length,this._hash=e.hash,this},p.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},p.prototype._finish=function(e,t){var n,i,o,a=t;if(e[a>>2]|=128<<(a%4<<3),a>55)for(r(this._hash,e),a=0;16>a;a+=1)e[a]=0;n=(n=8*this._length).toString(16).match(/(.*?)(.{0,8})$/),i=parseInt(n[2],16),o=parseInt(n[1],16)||0,e[14]=i,e[15]=o,r(this._hash,e)},p.hash=function(e,t){return p.hashBinary(u(e),t)},p.hashBinary=function(e,t){var r=s(o(e));return t?c(r):r},(p.ArrayBuffer=function(){this.reset()}).prototype.append=function(e){var t,n,o,a,s,u=(n=this._buff.buffer,o=e,a=!0,(s=new Uint8Array(n.byteLength+o.byteLength)).set(new Uint8Array(n)),s.set(new Uint8Array(o),n.byteLength),a?s:s.buffer),c=u.length;for(this._length+=e.byteLength,t=64;c>=t;t+=64)r(this._hash,i(u.subarray(t-64,t)));return this._buff=c>t-64?new Uint8Array(u.buffer.slice(t-64)):new Uint8Array(0),this},p.ArrayBuffer.prototype.end=function(e){var t,r,n=this._buff,i=n.length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;i>t;t+=1)o[t>>2]|=n[t]<<(t%4<<3);return this._finish(o,i),r=s(this._hash),e&&(r=c(r)),this.reset(),r},p.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},p.ArrayBuffer.prototype.getState=function(){var e=p.prototype.getState.call(this);return e.buff=String.fromCharCode.apply(null,new Uint8Array(e.buff)),e},p.ArrayBuffer.prototype.setState=function(e){return e.buff=function(e,t){var r,n=e.length,i=new ArrayBuffer(n),o=new Uint8Array(i);for(r=0;n>r;r+=1)o[r]=e.charCodeAt(r);return t?o:i}(e.buff,!0),p.prototype.setState.call(this,e)},p.ArrayBuffer.prototype.destroy=p.prototype.destroy,p.ArrayBuffer.prototype._finish=p.prototype._finish,p.ArrayBuffer.hash=function(e,t){var n=s(function(e){var t,n,o,a,s,u,c=e.length,p=[1732584193,-271733879,-1732584194,271733878];for(t=64;c>=t;t+=64)r(p,i(e.subarray(t-64,t)));for(e=c>t-64?e.subarray(t-64):new Uint8Array(0),n=e.length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],t=0;n>t;t+=1)o[t>>2]|=e[t]<<(t%4<<3);if(o[t>>2]|=128<<(t%4<<3),t>55)for(r(p,o),t=0;16>t;t+=1)o[t]=0;return a=(a=8*c).toString(16).match(/(.*?)(.{0,8})$/),s=parseInt(a[2],16),u=parseInt(a[1],16)||0,o[14]=s,o[15]=u,r(p,o),p}(new Uint8Array(e)));return t?c(n):n},p}()}).ArrayBuffer,gr=function(e){return yr(vr.hash(e,!0))},br=function(e,t){var r=File.prototype.slice,n=function(e,t){var r=e.config,n=t*r.partSize;return{start:n,end:Math.min(n+r.partSize,e.file.size)}}(e,t);return r.call(e.file,n.start,n.end)},wr=function(e,t){return(n=br(t,e.number),new Promise(function(e,t){var r;File&&FileReader&&Blob?((r=new FileReader).onloadend=e,r.onerror=t,r.readAsArrayBuffer(n)):t(Error("The File APIs are not fully supported by your browser"))})).then(function(t){var n=t.target.result;return r({},e,{buffer:n,size:n.byteLength,md5:gr(n)})});var n},kr=function(e){var t,r=e;return"string"==typeof e&&(r=function(e,t){var r;void 0===t&&(t=512);var n="";0>e.split(",")[0].indexOf("base64")||(r=e.split(",")[1]),void 0!==r&&(n=e.split(",")[0].split(":")[1].split(";")[0],e=decodeURI(r));for(var i=mr(e),o=[],a=0;i.length>a;a+=t){for(var s=i.slice(a,a+t),u=Array(s.length),c=0;s.length>c;c+=1)u[c]=s.charCodeAt(c);var p=new Uint8Array(u);o.push(p)}return new Blob(o,{type:n})}(r)),r&&(""+(t=r)=="[object File]"||""+t=="[object Blob]")?Promise.resolve(r):Promise.reject(new TypeError("File argument is not a valid Blob"))},_r=function(e,t){return t.customName||e.name},xr=function(e){return e&&"https://"+e},Er=function(e,t){var r=t.store,n={};return Object.keys(e).forEach(function(t){e[t]&&(n[t]=e[t])}),Object.keys(r).forEach(function(e){r[e]&&(n[e]=r[e])}),n},Ar=function(e,t){var n=t.config,i=t.params,o=xr(i.location_url),a=i.location_region,s=r({apikey:n.apikey,part:e.number+1,size:e.size,md5:e.md5},i);void 0!==e.offset&&(s.multipart=!0,s.offset=0===e.offset?"0":e.offset);var u=Er(s,n),c=xt("post",o+"/multipart/upload");return a&&c.set("Filestack-Upload-Region",a),c.timeout(n.timeout),c.field(u),new Promise(function(e,t){c.end(function(r,n){return r?t(r):e(n)})})},Tr=function(e,t,r,n){var i=n.timeout||e.byteLength/100,o=Et.put(t.url).set(t.headers).timeout(i).send(e);return r?o.on("progress",r):o},Or="init",Pr="running",Sr="done",Ir="failed",jr="paused",Cr=function(e,t){return function(){for(var r=[],n=0;arguments.length>n;n++)r[n]=arguments[n];return e.state.status===Ir?Promise.resolve():new Promise(function(n){var i=function(){e.state.status===jr?setTimeout(function(){return i()},100):n(t.apply(void 0,r))};i()})}},Br=function(e,t){return n(void 0,void 0,void 0,function(){var o,a,s,u;return i(this,function(c){switch(c.label){case 0:return!0===(o=t.config).intelligent||e.intelligentOverride?(a=Cr(t,function(e){return function(e,t){return n(void 0,void 0,void 0,function(){var r,n;return i(this,function(i){switch(i.label){case 0:return[4,Ar(e,t)];case 1:return r=i.sent().body,t.config.onProgress&&(n=Ct(function(t){t.loaded>e.loaded&&(e.loaded=t.loaded)},t.config.progressInterval)),e.request=Tr(e.buffer,r,n,t.config),[4,e.request];case 2:return i.sent(),e.loaded=e.size,[2,e.request]}})})}(e,t)}),e.chunks=function(e,t){for(var r=0,n=[];e.size>r;){var i=e.buffer.slice(r,Math.min(r+t,e.size)),o={buffer:i,offset:r,size:i.byteLength,number:e.number,md5:gr(i)};n.push(o),r+=t}return n}(e,e.chunkSize),[4,Promise.all(e.chunks.map(St(o.concurrency,a)))]):[3,2];case 1:return c.sent(),[2,function(e,t){var n=t.config,i=xr(t.params.location_url),o=r({apikey:n.apikey,part:e.number+1,size:t.file.size},t.params),a=Er(o,n);return xt("post",i+"/multipart/commit").timeout(n.timeout).field(a)}(e,t)];case 2:return[4,Ar(e,t)];case 3:return s=c.sent().body,o.onProgress&&(u=Ct(function(t){t.loaded>e.loaded&&(e.loaded=t.loaded)},o.progressInterval)),e.request=Tr(e.buffer,s,u,o),[2,e.request]}})})},zr=function(e){e.buffer=void 0,e.request=void 0,e.chunks&&e.chunks.length&&e.chunks.forEach(zr)},Nr=function(e){var t=e.config,r=e.state,n=e.file,i=Object.keys(r.parts).map(function(e){return r.parts[e]}),o=i.map(function(e){return e.loaded}),a=i.map(function(e){return e.chunks}).reduce(function(e,t){return e.concat(t)},[]).map(function(e){return e.loaded}).filter(function(e){return e}),s=o;(!0===t.intelligent&&(s=a),"fallback"===t.intelligent)&&(s=i.filter(function(e){return!e.intelligentOverride}).map(function(e){return e.loaded}).concat(a));var u=s.reduce(function(e,t){return e+t},0),c=function(e,t){return Math.round(e/t.size*100)}(u,n),p={totalBytes:u,totalPercent:c},l=r.previousPayload||{};return l.totalPercent>c&&(p.totalBytes=l.totalBytes,p.totalPercent=l.totalPercent),r.previousPayload=p,p},Rr=function(e,t){return n(void 0,void 0,void 0,function(){var o,a,s,u,c,p,l,f,d,h,m,y,v,g,b,w,k=this;return i(this,function(_){switch(_.label){case 0:return o=e.file,a=e.state,s=e.config,u=function(t){t&&(a.progressTick=setInterval(function(){var r=Nr(e);100===r.totalPercent&&clearInterval(a.progressTick),t(r)},s.progressInterval))},c=function(e){e&&(e({totalBytes:o.size,totalPercent:100}),clearInterval(a.progressTick))},t.pause=function(){a.status===Pr&&(a.status=jr,clearInterval(a.progressTick))},t.resume=function(){a.status===jr&&(a.status=Pr,u(s.onProgress))},p=function(){Object.keys(a.parts).map(function(e){return a.parts[e]}).forEach(function(e){e.request&&e.request.abort(),e.chunks.forEach(function(e){e.request&&e.request.abort()}),zr(e)})},l=function(){p(),clearInterval(a.progressTick),a.status=Ir},f=new Promise(function(e,r){t.cancel=function(){a.status!==Pr&&a.status!==jr||(l(),r(Error("Upload cancelled")))}}),d=function(e){return Promise.race([f,e])},h=function(e,t,r,n){var i=a.retries[e]||0,u=Math.min(s.retryMaxTime,1e3*Math.pow(s.retryFactor,i)),c=new Promise(function(c,p){if(i===s.retry||400===r.status&&"PUT"!==r.method||401===r.status||403===r.status||404===r.status||n&&32768>=n.chunkSize)return l(),p(r);var f=function(){return setTimeout(function(){return c(t())},u)};return n&&(s.intelligent||n.intelligentOverride)&&("PUT"===r.method&&(r.crossDomain||400===r.status||r.timeout)||"ECONNRESET"===r.code||"ETIMEDOUT"===r.code)?(n.chunkSize/=2,s.onRetry&&s.onRetry({location:e,parts:a.parts,filename:_r(o,s),chunkSize:n.chunkSize,attempt:void 0}),"fallback"===s.intelligent&&(n.intelligentOverride=!0),f()):(a.retries[e]=i+=1,s.onRetry&&s.onRetry({location:e,parts:a.parts,filename:_r(o,s),attempt:i}),f())});return d(c)},a.status=Pr,[4,d(function(e){var t=e.config,r=e.file,n={apikey:t.apikey,filename:_r(r,t),mimetype:t.mimetype||r.type||"application/octet-stream",size:r.size};t.policy&&t.signature&&(n.policy=t.policy,n.signature=t.signature),t.intelligent&&(n.multipart=!0);var i=Er(n,t);return xt("post",t.host+"/multipart/start").timeout(t.timeout).field(i)}(e))];case 1:return m=_.sent().body,e.params=m,y=Cr(e,function(t){return n(k,void 0,void 0,function(){var r,n,o,u,c;return i(this,function(i){switch(i.label){case 0:return[4,wr(t,e)];case 1:if(0===(r=i.sent()).size)return[2,Promise.reject(Error("Upload aborted due to empty chunk."))];n="upload part "+(r.number+1),a.parts[r.number]=r,i.label=2;case 2:return i.trys.push([2,4,,5]),[4,Br(r,e)];case 3:return o=i.sent(),u=o.headers.etag,206===o.status?[2,h(n,function(){return y(r)},Error("Intelligent part failed to commit"),r)]:(r.loaded=r.size,zr(r),s.intelligent||u?[2,u]:[2,Promise.reject(Error("Response from S3 is missing ETag header."))]);case 4:return c=i.sent(),[2,h(n,function(){return y(r)},c,r)];case 5:return[2]}})})}),v=function(e,t,r){void 0===r&&(r=1);for(var n=[];t>e;e+=r)n.push(e);return n}(0,Math.ceil(o.size/s.partSize)).map(function(t){return function(e,t){return{buffer:null,chunks:[],chunkSize:t.config.intelligentChunkSize?t.config.intelligentChunkSize:pr?1048576:8388608,intelligentOverride:!1,loaded:0,number:e,request:null,size:0}}(t,e)}),g=Promise.all(v.map(St(s.concurrency,y))),u(s.onProgress),[4,d(g)];case 2:return b=_.sent(),w=Cr(e,function(){return n(k,void 0,void 0,function(){var t,n;return i(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,function(e,t){var n=t.config,i=t.file,o=t.params,a=xr(o.location_url),s=o.location_region,u=r({apikey:n.apikey,size:i.size,filename:_r(i,n),mimetype:n.mimetype||i.type||"application/octet-stream",parts:function(e){return e.map(function(e,t){return t+1+":"+e}).join(";")}(e)},o);n.intelligent&&(u.multipart=!0,delete u.parts);var c=Er(u,n),p=xt("post",a+"/multipart/complete");return s&&p.set("Filestack-Upload-Region",s),p.timeout(n.timeout),p.field(c)}(b,e)];case 1:return 202===(t=i.sent()).status?[2,new Promise(function(e){setTimeout(function(){return e(w())},1e3)})]:(a.status=Sr,c(s.onProgress),t.body&&t.body.error&&t.body.error.text?[2,Promise.reject(Error("File upload error: "+t.body.error.text))]:[2,t.body]);case 2:return n=i.sent(),[2,h("complete",w,n)];case 3:return[2]}})})}),[2,d(w())]}})})},Ur=function(e,t,n){if(!t||"string"!=typeof t)throw Error("A valid Filestack handle or storage alias is required for preview");It("preview",[{name:"id",type:Qe},{name:"css",type:Qe}],n);var i=jt(n),o=function(e,t,n,i){var o=r({},n),a=i&&i.policy||e.policy,s=i&&i.signature||e.signature,u=s&&a,c=[e.urls.cdnUrl],p=o.css&&encodeURIComponent('"'+o.css+'"'),l=p?"preview=css:"+p:"preview";return-1!==t.indexOf("src:")?c.push(e.apikey+"/"+l):c.push(l),u&&c.push("security=policy:"+a+",signature:"+s),c.push(t),c.join("/")}(e,t,i);if(i.id){var a=i.id,s=document.createElement("iframe"),u=document.getElementById(a);if(s.src=o,s.width="100%",s.height="100%",!u)throw Error('DOM Element with id "'+a+'" not found.');return u.appendChild(s)}return window.open(o,t)},qr=function(){function e(e,t){this.cache=!1,this.session=e,this.cloudApiUrl=e.urls.cloudApiUrl,t&&t.sessionCache&&(this.cache=t.sessionCache)}return Object.defineProperty(e.prototype,"token",{get:function(){if(this.cache){var e=localStorage.getItem("__fs_picker_token");if(e)return e}return this._token},set:function(e){this.cache&&localStorage.setItem("__fs_picker_token",e),this._token=e},enumerable:!0,configurable:!0}),e.prototype.prefetch=function(){var e={apikey:this.session.apikey};return xt("get",this.cloudApiUrl+"/prefetch").query(e).then(function(e){return e.body})},e.prototype.list=function(e,t){var r=this;void 0===t&&(t={});var n={apikey:this.session.apikey,clouds:e,flow:"web",token:this.token};return this.session.policy&&this.session.signature&&(n.policy=this.session.policy,n.signature=this.session.signature),new Promise(function(e,i){var o=xt("post",r.cloudApiUrl+"/folder/list").send(n).end(function(t,n){t?i(t):(n.body&&n.body.token&&(r.token=n.body.token),e(n.body))});t.cancel=function(){o.abort(),i(Error("Cancelled"))}})},e.prototype.store=function(e,t,r,n,i){var o,a=this;void 0===r&&(r={}),void 0===n&&(n={}),void 0===i&&(i={}),void 0===r.location&&(r.location="s3");var s={apikey:this.session.apikey,token:this.token,flow:"web",clouds:(o={},o[e]={path:t,store:jt(r)},o)};return"customsource"===e&&n.customSourcePath&&(s.clouds.customsource.customSourcePath=n.customSourcePath),"customsource"===e&&n.customSourceContainer&&(s.clouds.customsource.customSourceContainer=n.customSourceContainer),this.session.policy&&this.session.signature&&(s.policy=this.session.policy,s.signature=this.session.signature),new Promise(function(t,r){var n=xt("post",a.cloudApiUrl+"/store/").send(s).end(function(n,i){n?r(n):(i.body&&i.body.token&&(a.token=i.body.token),t(i.body&&i.body[e]?i.body[e]:i.body))});i.cancel=function(){n.abort(),r(Error("Cancelled"))}})},e.prototype.link=function(e,t,r,n){var i,o=this;void 0===r&&(r={}),void 0===n&&(n={});var a={apikey:this.session.apikey,token:this.token,flow:"web",clouds:(i={},i[e]={path:t},i)};return"customsource"===e&&r.customSourcePath&&(a.clouds.customsource.customSourcePath=r.customSourcePath),"customsource"===e&&r.customSourceContainer&&(a.clouds.customsource.customSourceContainer=r.customSourceContainer),this.session.policy&&this.session.signature&&(a.policy=this.session.policy,a.signature=this.session.signature),new Promise(function(t,r){var i=xt("post",o.cloudApiUrl+"/link/").send(a).end(function(n,i){n?r(n):(i.body&&i.body.token&&(o.token=i.body.token),t(i.body[e]?i.body[e]:i.body))});n.cancel=function(){i.abort(),r(Error("Cancelled"))}})},e.prototype.logout=function(e){var t,r=this,n={apikey:this.session.apikey,flow:"web",token:this.token};return e?n.clouds=((t={})[e]={},t):this.cache&&localStorage.removeItem("__fs_picker_token"),new Promise(function(e,t){xt("post",r.cloudApiUrl+"/auth/logout/").send(n).end(function(n,i){n?t(n):(i.body&&i.body.token&&(r.token=i.body.token),e(i.body))})})},e.prototype.metadata=function(e){var t=this,r={apikey:this.session.apikey,url:e};return this.session.policy&&this.session.signature&&(r.policy=this.session.policy,r.signature=this.session.signature),new Promise(function(e,n){xt("post",t.cloudApiUrl+"/metadata").send(r).end(function(t,r){t?n(t):e(r.body)})})},e.prototype.tokInit=function(e){var t=this;if("video"!==e&&"audio"!==e)throw Error("Type must be one of video or audio.");return new Promise(function(r,n){return xt("post",t.cloudApiUrl+"/recording/"+e+"/init").end(function(e,t){e?n(e):r(t)})})},e.prototype.tokStart=function(e,t,r){var n=this;if("video"!==e&&"audio"!==e)throw Error("Type must be one of video or audio.");var i={apikey:t,session_id:r};return new Promise(function(t,r){return xt("post",n.cloudApiUrl+"/recording/"+e+"/start").send(i).end(function(e,n){e?r(e):t(n)})})},e.prototype.tokStop=function(e,t,r,n){var i=this;if("video"!==e&&"audio"!==e)throw Error("Type must be one of video or audio.");var o={apikey:t,session_id:r,archive_id:n};return new Promise(function(t,r){return xt("post",i.cloudApiUrl+"/recording/"+e+"/stop").send(o).end(function(e,n){e?r(e):t(n)})})},e}(),Dr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Mr=(lr=void 0,"object"===("undefined"==typeof window?"undefined":Dr(window))&&((lr=window.filestackInternals)||(lr={},window.filestackInternals=lr),lr.loader||(lr.loader={modules:{}})),lr),Fr=Mr&&Mr.loader.modules,$r=function(e,t){var r=Fr[e];if(r||(Fr[e]={},r=Fr[e]),r.instance)return Promise.resolve(r.instance);if(r.promise)return r.promise;var n=new Promise(function(n,i){!function o(){"complete"===document.readyState?function(){r.resolvePromise=n;var o=document.createElement("script");o.src=e,o.onerror=i,t&&(o.id=t),document.body.appendChild(o)}():setTimeout(o,50)}()});return r.promise=n,n},Lr="__filestack-picker-module";!function(e){e.cw="CW",e.ccw="CCW"}(fr||(fr={})),function(e){e.inline="inline",e.overlay="overlay",e.dropPane="dropPane"}(dr||(dr={}));var Hr=function(){function e(e,t){this._initialized=this.loadModule(e,t)}return e.prototype.open=function(){return n(this,void 0,void 0,function(){return i(this,function(e){switch(e.label){case 0:return[4,this._initialized];case 1:return[4,e.sent().open()];case 2:return e.sent(),[2]}})})},e.prototype.crop=function(e){return n(this,void 0,void 0,function(){return i(this,function(t){switch(t.label){case 0:return[4,this._initialized];case 1:return[4,t.sent().crop(e)];case 2:return t.sent(),[2]}})})},e.prototype.close=function(){return n(this,void 0,void 0,function(){return i(this,function(e){switch(e.label){case 0:return[4,this._initialized];case 1:return[4,e.sent().close()];case 2:return e.sent(),[2]}})})},e.prototype.cancel=function(){return n(this,void 0,void 0,function(){return i(this,function(e){switch(e.label){case 0:return[4,this._initialized];case 1:return[4,e.sent().cancel()];case 2:return e.sent(),[2]}})})},e.prototype.loadModule=function(e,t){return n(this,void 0,void 0,function(){return i(this,function(r){switch(r.label){case 0:return[4,$r(e.session.urls.pickerUrl,Lr)];case 1:return[2,new(r.sent())(e,t)]}})})},e}(),Vr=function(){function e(e,r){var n=this;if(!e||"string"!=typeof e||0===e.length)throw Error("An apikey is required to initialize the Filestack client");var i=t.urls;if(this.session={apikey:e,urls:i},r){var o=r.cname,a=r.security;if(a&&(!a.policy||!a.signature))throw Error("Both policy and signature are required for client security");if(a&&a.policy&&a.signature&&(this.session.policy=a.policy,this.session.signature=a.signature),o){var s=/filestackapi.com|filestackcontent.com/i;this.session.cname=o,Object.keys(i).forEach(function(e){n.session.urls[e]=i[e].replace(s,o)})}}this.cloud=new qr(this.session,r)}return e.prototype.logout=function(e){return this.cloud.logout(e)},e.prototype.metadata=function(e,t,n){return function(e,t,n,i){if(!t||"string"!=typeof t)throw Error("A valid Filestack handle is required for metadata");It("metadata",[{name:"size",type:Ge},{name:"mimetype",type:Ge},{name:"filename",type:Ge},{name:"width",type:Ge},{name:"height",type:Ge},{name:"uploaded",type:Ge},{name:"writeable",type:Ge},{name:"cloud",type:Ge},{name:"sourceUrl",type:Ge},{name:"md5",type:Ge},{name:"sha1",type:Ge},{name:"sha224",type:Ge},{name:"sha256",type:Ge},{name:"sha384",type:Ge},{name:"sha512",type:Ge},{name:"location",type:Ge},{name:"path",type:Ge},{name:"container",type:Ge},{name:"exif",type:Ge}],n);var o=r({},n);o.source_url=o.sourceUrl,o.policy=i&&i.policy||e.policy,o.signature=i&&i.signature||e.signature;var a=e.urls.fileApiUrl+"/"+t+"/metadata";return new Promise(function(e,n){Et.get(a).query(jt(o)).end(function(i,o){i?n(i):e(r({},o.body,{handle:t}))})})}(this.session,e,t,n)},e.prototype.picker=function(e){return function(e,t){return new Hr(e,t)}(this,e)},e.prototype.preview=function(e,t){return Ur(this.session,e,t)},e.prototype.remove=function(e,t){return Bt(this.session,e,!1,t)},e.prototype.removeMetadata=function(e,t){return Bt(this.session,e,!0,t)},e.prototype.storeURL=function(e,t,n,i){return function(e,t,n,i,o){if(!t||"string"!=typeof t)throw Error("url is required for storeURL");var a=[{name:"filename",type:Qe},{name:"location",type:Ye.of("s3 gcs rackspace azure dropbox")},{name:"path",type:Qe},{name:"region",type:Qe},{name:"container",type:Qe},{name:"access",type:Ye.of("public private")}];It("storeURL",a,n);var s=r({},n),u=s.location||"s3";s.key=e.apikey,s.policy=o&&o.policy||e.policy,s.signature=o&&o.signature||e.signature;var c=e.urls.storeApiUrl+"/"+u;return new Promise(function(e,n){var o=Et.post(c).query(jt(s)).field("url",t);i&&(i.cancel=function(){o.abort(),n(Error("Upload cancelled"))}),o.then(function(t){if(t.body&&t.body.url){var n=t.body.url.split("/").pop(),i=r({},t.body,{handle:n,mimetype:t.body.type});e(i)}else e(t.body)}).catch(function(e){n(e)})})}(this.session,e,t,n,i)},e.prototype.retrieve=function(e,t,n){return function(e,t,n,i){if(void 0===n&&(n={}),!t||0===t.length||"string"!=typeof t)throw Error("File handle is required");It("retrieveOptions",[{name:"metadata",type:Ge},{name:"head",type:Ge},{name:"dl",type:Ge},{name:"cache",type:Ge},{name:"extension",type:Qe}],n);var o=r({},n);o.key=e.apikey,o.policy=i&&i.policy||e.policy,o.signature=i&&i.signature||e.signature;var a,s,u=Ot.get,c=Pt.blob;if(o.head&&(u=Ot.head,c=Pt.json,delete o.head),o.extension&&o.extension.length&&(a=o.extension,delete o.extension),o.metadata){if(u===Ot.head)throw Error("Head and metadata options cannot be used together");c=Pt.json,s=o.metadata,delete o.metadata}var p=e.urls.fileApiUrl+"/"+t+(a?"+"+a:"")+(s?"/metadata":"");return new Promise(function(e,t){Et[u](p).query(o).responseType(c).end(function(r,n){return r?t(r):u===Ot.head?e(n.headers):void e(n.body)})})}(this.session,e,t,n)},e.prototype.transform=function(e,t){return cr(this.session,e,t)},e.prototype.upload=function(e,t,n,i,o){return function(e,t,n,i,o,a){return void 0===n&&(n={}),void 0===i&&(i={}),void 0===o&&(o={}),kr(t).then(function(t){if(void 0!==t.size&&0===t.size||0===t.length)return Promise.reject(Error("file has a size of 0."));var s=[{name:"host",type:Qe},{name:"path",type:Ge},{name:"mimetype",type:Qe},{name:"partSize",type:Ze},{name:"concurrency",type:et(Ke,function(e){return e>0})},{name:"onProgress",type:Je},{name:"progressInterval",type:Ke},{name:"onRetry",type:Je},{name:"retry",type:Ke},{name:"retryFactor",type:Ke},{name:"retryMaxTime",type:Ke},{name:"timeout",type:Ke},{name:"intelligent",type:tt([Ge,Ye.of("fallback")])},{name:"intelligentChunkSize",type:Ze}],u=[{name:"location",type:Ye.of("s3 gcs rackspace azure dropbox")},{name:"region",type:Qe},{name:"path",type:Qe},{name:"container",type:Qe},{name:"filename",type:Qe},{name:"access",type:Ye.of("public private")}];It("upload (options)",s,n),It("upload (storeOptions)",u,i);var c,p=r({},i),l=r({},n);p.filename?c=p.filename:void 0===t.name&&(c=t.type?"untitled."+t.type.split("/").pop():"untitled"),void 0===p.location&&(p.location="s3"),l.intelligent&&(l.partSize=8388608);var f=r({host:e.urls.uploadApiUrl,apikey:e.apikey,policy:a&&a.policy||e.policy,signature:a&&a.signature||e.signature,partSize:6291456,concurrency:3,progressInterval:1e3,retry:10,retryFactor:2,retryMaxTime:15e3,customName:c,mimetype:n.mimetype,store:{store_location:p.location,store_region:p.region,store_container:p.container,store_path:p.path,store_access:p.access},timeout:12e4},l);return Rr({file:t,config:f,state:{parts:{},progressTick:null,previousPayload:null,retries:{},status:Or}},o)})}(this.session,e,t,n,i,o)},e}();e.init=function(e,t){return new Vr(e,t)},e.version="1.4.0",e.getSecurity=function(){console.warn("This method is only availale in Node runtimes")},Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=filestack.min.js.map
